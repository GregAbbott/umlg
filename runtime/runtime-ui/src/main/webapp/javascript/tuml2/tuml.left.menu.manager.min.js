!function(e){function i(){function i(){}function n(i,n,a,t){var r=e("<div />",{"class":"panel panel-default"}).appendTo(i),o=e("<div />",{"class":"panel-heading"}).appendTo(r),s=e("<h4 />",{"class":"panel-title"}).appendTo(o);e('<a data-toggle="collapse" data-parent="#accordion" class="accordion-toggle" href="#'+t+'" />').text(a).appendTo(s);var l=e("<div />",{id:t,"class":"panel-collapse collapse "+(n?"in":"")}).appendTo(r),u=e("<div />",{"class":"umlg-leftmenu-panel-body panel-body"}).appendTo(l);return u}var a=this;this.accordionDiv=null,this.umlPropertiesDiv=null,this.umlOperationsDiv=null,this.umlInstanceQueriesDiv=null,this.umlClassQueriesDiv=null,this.umlRootQueriesDiv=null,this.umlInstanceGroovyDiv=null,this.umlClassGroovyDiv=null,this.contextMetaDataFrom=null,this.contextMetaDataTo=null,this.contextVertexId=null,this.tabContainer=null,this.queryToHighlightId=-1,this.clickedProperty=null,this.refresh=function(i,n,a,t){this.contextMetaDataFrom=i,this.contextMetaDataTo=n,this.contextVertexId=void 0!==a&&null!==a?decodeURIComponent(a):null;var r=e("#leftMenuPaneH3l");r.empty(),e("#diagramTreeView").tree("destroy");var o=e("#leftMenuPaneBody");o.empty(),r.text(this.contextMetaDataFrom.name),this.tabContainer=o,this.setupTabsAndAccordion(),this.createPropertiesMenu(t),this.createDiagramsTreeView(),isUmlgLib&&void 0!==this.contextVertexId&&null!==this.contextVertexId&&(this.createInstanceQueryMenu(-1),this.createClassQueryMenu(-1),this.createRootQueryMenu(-1));var s=calculateBodyHeight(this)+45;o.height(s)},this.setupTabsAndAccordion=function(){var i=e("<ul />",{id:"tabContainer-menu-container","class":"nav nav-tabs"}).appendTo(this.tabContainer),a=e("<div />",{"class":"tab-content"}).appendTo(this.tabContainer),t="<li class='active'><a href='#Standard' data-toggle='tab'>Standard</a></li>",r=e(t);i.append(r);var o="<li><a href='#Tree' data-toggle='tab'>Tree</a></li>",s=e(o);i.append(s);var l=e("<div />",{id:"Standard","class":"tab-pane active"});a.append(l);var u=e("<div />",{id:"Tree","class":"tab-pane"});a.append(u),i.find("a").click(function(i){i.preventDefault(),e(this).tab("show")}),i.find("a:first").tab("show"),this.accordionDiv=e("<div />",{id:"accordion","class":"panel-group"}).appendTo(l),this.umlPropertiesDiv=n(this.accordionDiv,!0,Tuml.AccordionEnum.PROPERTIES.label,Tuml.AccordionEnum.PROPERTIES.id),this.umlOperationsDiv=n(this.accordionDiv,!1,Tuml.AccordionEnum.OPERATIONS.label,Tuml.AccordionEnum.OPERATIONS.id),this.umlDiagramDiv=n(this.accordionDiv,!1,Tuml.AccordionEnum.DIAGRAMS.label,Tuml.AccordionEnum.DIAGRAMS.id),isUmlgLib&&void 0!==this.contextVertexId&&null!==this.contextVertexId&&(this.umlInstanceQueriesDiv=n(this.accordionDiv,!1,Tuml.AccordionEnum.INSTANCE_QUERIES.label,Tuml.AccordionEnum.INSTANCE_QUERIES.id),this.umlClassQueriesDiv=n(this.accordionDiv,!1,Tuml.AccordionEnum.CLASS_QUERIES.label,Tuml.AccordionEnum.CLASS_QUERIES.id),this.umlInstanceGroovyDiv=n(this.accordionDiv,!1,Tuml.AccordionEnum.INSTANCE_GROOVY.label,Tuml.AccordionEnum.INSTANCE_GROOVY.id),this.umlClassGroovyDiv=n(this.accordionDiv,!1,Tuml.AccordionEnum.CLASS_GROOVY.label,Tuml.AccordionEnum.CLASS_GROOVY.id)),this.umlRootQueriesDiv=n(this.accordionDiv,!1,Tuml.AccordionEnum.ROOT_QUERIES.label,Tuml.AccordionEnum.ROOT_QUERIES.id)},this.setFocus=function(){var i=this.accordionDiv.accordion("option","active");switch(i){case Tuml.AccordionEnum.PROPERTIES.index:var n=e("#propertiesMenu");n.focus();break;case Tuml.AccordionEnum.OPERATIONS.index:break;case Tuml.AccordionEnum.INSTANCE_QUERIES.index:var n=e("#instanceQueryMenu");n.focus();break;case Tuml.AccordionEnum.CLASS_QUERIES.index:var n=e("#classQueryMenu");n.focus();break;case Tuml.AccordionEnum.INSTANCE_GROOVY.index:break;case Tuml.AccordionEnum.CLASS_GROOVY.index:break;case Tuml.AccordionEnum.DIAGRAMS.index:break;default:throw"Unknown active accordion!"}},this.createDiagramsTreeView=function(){var i=this;this.diagramsTreeViewDiv=e("<div />",{id:"diagramTreeView"}).appendTo(this.umlDiagramDiv);var n="/"+tumlModelName+"/diagramPackages";e.ajax({url:n,type:"GET",dataType:"json",contentType:"application/json",success:function(n){e(function(){i.diagramsTreeViewDiv.tree({data:n,selectable:!0}),i.diagramsTreeViewDiv.bind("tree.dblclick",function(e){event.preventDefault(),event.stopImmediatePropagation(),0==e.node.children.length&&i.onDiagramClick.notify(e.node,null,i)})})},error:function(e){console.log(e)}})},this.createPropertiesMenu=function(i){var n=this,a=e("<div />",{"class":"dropdown"}).appendTo(this.umlPropertiesDiv);e('<a href="#" class="sr-only dropdown-toggle" data-toggle="dropdown">Users <b class="caret"></b></a>').appendTo(a);for(var t=e('<ul id="propertiesMenu" class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" />').appendTo(a),r=this.createLeftMenuDataArray(this.contextMetaDataFrom,this.contextMetaDataTo,i),o=0;o<r.length;o++){var s=r[o],l=s.tumlUri.replace(new RegExp("{(s*?.*?)*?}","gi"),encodeURIComponent(this.contextVertexId));l=addUiToUrl(l);var u=e("<li />",{role:"presentation"}).appendTo(t);u.data("contextData",{name:s.name,uri:l,property:s.property}),s.active&&u.addClass("active");var c=e("<a />",{title:s.name,role:"menuitem",tabindex:-1,href:l}).appendTo(u);c.on("click",function(i){var a=e(i.target);a.parent().addClass("active");var t=a.parent().data("contextData");n.clickedProperty=void 0!=t.property?t.property:null,n.onMenuClick.notify({name:t.name,uri:removeUiFromUrl(t.uri)},null,n),i.preventDefault(),i.stopImmediatePropagation()}),e('<i class="umlg-icon '+s.menuIconClass+'"></i>').appendTo(c),c.append(void 0!==s.multiplicityDisplay?" "+s.name+" "+s.multiplicityDisplay:" "+s.name),s.derived&&c.append(" {derived}"),void 0!==s.qualified&&s.qualified&&c.append(" [qualified]")}return t},this.createQueryMenu=function(i,n,t){for(var r=[],o=0;o<t[0].data.length;o++){var s,l=t[0].data[o],u=l.uri.replace(new RegExp("{(s*?.*?)*?}","gi"),encodeURIComponent(l.id)),c=t[0].meta.oclExecuteUri.replace(new RegExp("{(s*?.*?)*?}","gi"),this.contextVertexId),d="querymenuinactive ";if(n==tuml.tab.Enum.InstanceQueries)s="instanceQuery",d+="instance-query";else if(n==tuml.tab.Enum.ClassQueries)s="classQuery",d+="class-query";else{if(n!=tuml.tab.Enum.RootQueries)throw"Unexpected query enum!";s="rootQuery",d+="root-query"}r.push({label:l.name,tumlUri:u,oclExecuteUri:c,name:l.name,_name:l.name,queryEnum:l.queryEnum,queryString:l.queryString,queryId:l.id,queryType:s,menuCssClass:d})}var m=e("<div />",{"class":"dropdown"}).appendTo(i);e('<a href="#" class="sr-only dropdown-toggle" data-toggle="dropdown">Users <b class="caret"></b></a>').appendTo(m);var p;if(n==tuml.tab.Enum.InstanceQueries)p=e('<ul id="instanceQueryMenu" class="dropdown-menu" role="menu" aria-labelledby="dropdownQueryMenu1" />').appendTo(m);else if(n==tuml.tab.Enum.ClassQueries)p=e('<ul id="classQueryMenu" class="dropdown-menu" role="menu" aria-labelledby="dropdownQueryMenu1" />').appendTo(m);else{if(n!=tuml.tab.Enum.RootQueries)throw"Unexpected query enum!";p=e('<ul id="rootQueryMenu" class="dropdown-menu" role="menu" aria-labelledby="dropdownQueryMenu1" />').appendTo(m)}for(var o=0;o<r.length;o++){var h=r[o],v=h.tumlUri.replace(new RegExp("{(s*?.*?)*?}","gi"),this.contextVertexId),E=e("<li />",{id:h.queryId,role:"presentation"}).appendTo(p);E.data("contextData",h);var T=e("<a />",{title:h.name,href:v}).appendTo(E);T.on("click",function(i){var n=e(i.target),t=e(i.target).parent().data("contextData"),r={post:!1,tumlUri:t.tumlUri,oclExecuteUri:t.oclExecuteUri,qualifiedName:t.qualifiedName,name:t._name,queryEnum:t.queryEnum,queryString:t.queryString,queryType:t.queryType,id:t.queryId};n.parent().parent().children("li.active").removeClass("active"),n.parent().addClass("active"),a.onQueryClick.notify(r,null,a),n.focus(),i.preventDefault(),i.stopImmediatePropagation()}),e("<i />",{"class":"fa fa-bolt"}).appendTo(T),T.append(" "+h.name)}},this.createInstanceQueryMenu=function(i){var n=this;this.queryToHighlightId=i;var a=this.findQueryUrl("instanceQuery");if(null!=a){var t=a.tumlUri.replace(new RegExp("{(s*?.*?)*?}","gi"),encodeURIComponent(this.contextVertexId));e.ajax({url:t,type:"GET",dataType:"json",contentType:"json",success:function(e){retrieveMetaDataIfNotInCache(t,this.contextVertexId,e,n.continueCreateInstanceQueryMenu)},error:function(e,i,n){alert("Error getting instance query data. textStatus: "+i+" errorThrown: "+n)}})}},this.continueCreateInstanceQueryMenu=function(e,i){a.createQueryMenu(a.umlInstanceQueriesDiv,tuml.tab.Enum.InstanceQueries,i),void 0!==a.queryToHighlightId&&-1!=a.queryToHighlightId&&a.refreshQueryMenuCss(a.queryToHighlightId,Tuml.AccordionEnum.INSTANCE_QUERIES.index)},this.createClassQueryMenu=function(i){var n=this;if(this.queryToHighlightId=i,null!==this.contextVertexId){var a="/"+tumlModelName+"/classquery/"+encodeURIComponent(this.contextVertexId)+"/query";e.ajax({url:a,type:"GET",dataType:"json",contentType:"json",success:function(e){retrieveMetaDataIfNotInCache(a,this.contextVertexId,e,n.continueCreateClassQueryMenu)},error:function(e,i,n){alert("Error getting class query data. textStatus: "+i+" errorThrown: "+n)}})}},this.continueCreateClassQueryMenu=function(e,i){a.createQueryMenu(a.umlClassQueriesDiv,tuml.tab.Enum.ClassQueries,i),-1!==a.queryToHighlightId&&a.refreshQueryMenuCss(a.queryToHighlightId,Tuml.AccordionEnum.CLASS_QUERIES.index)},this.createRootQueryMenu=function(i){var n=this;this.queryToHighlightId=i;var a="/"+tumlModelName+"/rootquerys";e.ajax({url:a,type:"GET",dataType:"json",contentType:"json",success:function(e){retrieveMetaDataIfNotInCache(a,null,e,n.continueCreateRootQueryMenu)},error:function(e,i,n){alert("Error getting root query data. textStatus: "+i+" errorThrown: "+n)}})},this.continueCreateRootQueryMenu=function(e,i){a.createQueryMenu(a.umlRootQueriesDiv,tuml.tab.Enum.RootQueries,i),-1!==a.queryToHighlightId&&a.refreshQueryMenuCss(a.queryToHighlightId,Tuml.AccordionEnum.ROOT_QUERIES.index)},this.deleteInstanceQuery=function(e){this.umlInstanceQueriesDiv.find("#"+e).remove()},this.deleteClassQuery=function(e){this.umlClassQueriesDiv.find("#"+e).remove()},this.deleteRootQuery=function(e){this.umlRootQueriesDiv.find("#"+e).remove()},this.refreshInstanceQuery=function(e){this.umlInstanceQueriesDiv.children().remove(),this.createInstanceQueryMenu(e)},this.refreshClassQuery=function(e){this.umlClassQueriesDiv.children().remove(),this.createClassQueryMenu(e)},this.refreshRootQuery=function(e){this.umlRootQueriesDiv.children().remove(),this.createRootQueryMenu(e)},this.refreshQueryMenuCss=function(i,n){if(null!==this.umlInstanceQueriesDiv&&(this.umlInstanceQueriesDiv.find("li.active").removeClass("active"),this.umlInstanceQueriesDiv.find("#"+i).addClass("active")),null!==this.umlClassQueriesDiv&&(this.umlClassQueriesDiv.find("li.active").removeClass("active"),this.umlClassQueriesDiv.find("#"+i).addClass("active")),null!==this.umlRootQueriesDiv&&(this.umlRootQueriesDiv.find("li.active").removeClass("active"),this.umlRootQueriesDiv.find("#"+i).addClass("active")),-1!=n)if(e("#accordion").on("show.bs.collapse",function(){e("#accordion .in").collapse("hide")}),n==Tuml.AccordionEnum.PROPERTIES.index){var a=this.umlPropertiesDiv.parent();a.hasClass("in")||a.collapse("show")}else if(n==Tuml.AccordionEnum.OPERATIONS.index){var t=this.umlOperationsDiv.parent();t.hasClass("in")||t.collapse("show")}else if(n==Tuml.AccordionEnum.INSTANCE_QUERIES.index){var r=this.umlInstanceQueriesDiv.parent();r.hasClass("in")||r.collapse("show")}else if(n==Tuml.AccordionEnum.CLASS_QUERIES.index){var o=this.umlClassQueriesDiv.parent();o.hasClass("in")||o.collapse("show")}else if(n==Tuml.AccordionEnum.ROOT_QUERIES.index){var s=this.umlRootQueriesDiv.parent();s.hasClass("in")||s.collapse("show")}else if(n==Tuml.AccordionEnum.CLASS_GROOVY.index){var l=this.umlClassGroovyDiv.parent();l.hasClass("in")||l.collapse("show")}else{if(n!=Tuml.AccordionEnum.INSTANCE_GROOVY.index)throw"Unknown accordion index!";var u=this.umlInstanceGroovyDiv.parent();u.hasClass("in")||u.collapse("show")}},this.refreshDiagramCss=function(i,n){if(-1!=n)if(e("#accordion").on("show.bs.collapse",function(){e("#accordion .in").collapse("hide")}),n==Tuml.AccordionEnum.PROPERTIES.index){var a=this.umlPropertiesDiv.parent();a.hasClass("in")||a.collapse("show")}else if(n==Tuml.AccordionEnum.OPERATIONS.index){var t=this.umlOperationsDiv.parent();t.hasClass("in")||t.collapse("show")}else if(n==Tuml.AccordionEnum.INSTANCE_QUERIES.index){var r=this.umlInstanceQueriesDiv.parent();r.hasClass("in")||r.collapse("show")}else if(n==Tuml.AccordionEnum.CLASS_QUERIES.index){var o=this.umlClassQueriesDiv.parent();o.hasClass("in")||o.collapse("show")}else if(n==Tuml.AccordionEnum.ROOT_QUERIES.index){var s=this.umlRootQueriesDiv.parent();s.hasClass("in")||s.collapse("show")}else if(n==Tuml.AccordionEnum.CLASS_GROOVY.index){var l=this.umlClassGroovyDiv.parent();l.hasClass("in")||l.collapse("show")}else if(n==Tuml.AccordionEnum.INSTANCE_GROOVY.index){var u=this.umlInstanceGroovyDiv.parent();u.hasClass("in")||u.collapse("show")}else{if(n!=Tuml.AccordionEnum.DIAGRAMS.index)throw"Unknown accordion index!";var c=this.umlDiagramDiv.parent();c.hasClass("in")||c.collapse("show");var d=this.diagramsTreeViewDiv.tree("getNodeById",i);this.diagramsTreeViewDiv.tree("selectNode",d)}},this.createLeftMenuDataArray=function(e){function i(e,i){return e.name<i.name?-1:e.name>i.name?1:0}for(var n=[],a=0;a<e.properties.length;a++){var t=e.properties[a];if(t.inverseComposite||!(void 0!==t.dataTypeEnum&&null!==t.dataTypeEnum||t.onePrimitive||t.oneEnumeration||t.manyEnumeration||t.manyPrimitive||"id"==t.name||"uri"==t.name)){var r={active:!1};null!==this.clickedProperty&&this.clickedProperty.qualifiedName===t.qualifiedName&&(r.active=!0);var o="ui-icon";if(o+=t.composite?" ui-icon-umlcomposition":t.associationClassOne&&!t.memberEndOfAssociationClass?" ui-icon-umlassociationclass":" ui-icon-umlassociation",r.tumlUri=t.tumlUri,t.associationClassOne&&!t.memberEndOfAssociationClass){var s=t.name.split("_");r.name=1===s.length?s[0]:s[0]+"["+s[1]+"]"}else r.name=t.name;r.menuIconClass=o,r.multiplicityDisplay=-1==t.upper?"["+t.lower+"..*]":"["+t.lower+".."+t.upper+"]",r.property=t,r.derived=t.derived,r.qualified=t.qualified,n.push(r)}}return n.sort(i),e.name!==tumlModelName&&n.splice(0,0,{tumlUri:e.uri,name:e.name,menuIconClass:"ui-icon ui-icon-umlactivity-final-node",aCssClass:""}),n},this.findQueryUrl=function(e){for(var i=null,n=0;n<this.contextMetaDataFrom.properties.length;n++){var a=this.contextMetaDataFrom.properties[n];if(a.name==e){i=a;break}}return i},e.extend(this,{TumlLeftMenuManagerVersion:"1.0.0",onMenuClick:new Tuml.Event,onQueryClick:new Tuml.Event,onDiagramClick:new Tuml.Event}),i()}e.extend(!0,window,{Tuml:{LeftMenuManager:i,AccordionEnum:{PROPERTIES:{index:0,label:"Properties",id:"propertiesAccordion"},OPERATIONS:{index:1,label:"Operations",id:"operationAccordion"},INSTANCE_QUERIES:{index:2,label:"Instance Queries",id:"instanceQueriesAccordion"},CLASS_QUERIES:{index:3,label:"Class Queries",id:"classQueriesAccordion"},ROOT_QUERIES:{index:4,label:"Root Queries",id:"rootQueriesAccordion"},INSTANCE_GROOVY:{index:5,label:"Instance Groovy",id:"instanceQueriesAccordion"},CLASS_GROOVY:{index:6,label:"Class Groovy",id:"classGroovy"},DIAGRAMS:{index:7,label:"Diagrams",id:"diagrams"}}}})}(jQuery);