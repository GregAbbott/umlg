!function(e){function a(){var e={};this.addToOneToOneIndex=function(a,t){e[a]=t},this.getIndex=function(a){return void 0!==e[a]&&null!==e[a]?e[a]:null}}function t(t,r){function i(e){for(var a=0;a<e.length;a++){var t=e[a],r=l.tumlTabViewManagers.indexOf(t);l.tumlTabViewManagers.splice(r,1)}for(var a=0;a<e.length;a++)l.tumlTabViewManagers.push(e[a]);s()}function n(e,a){var t;t=void 0!==a?a.properties:e.properties;for(var r=0;r<t.length;r++){var i=t[r];if("instanceQuery"!==i.name)return!0}return!1}function u(e,a,t,r){for(var i=null,n=0;n<a.length;n++){null!==i&&(i.open=!1);var u=l.createTabContainer(tuml.tab.Enum.Properties,a[n],e,{forLookup:!1,forManyComponent:!1,isOne:t,forCreation:r},l.propertyNavigatingTo);if(l.addToTumlTabViewManagers(u),r){var s={id:"fake::"+Tuml.TumlFakeIndex++};s.tmpId=s.id,a[n].data=s}u.createTab(a[n],r),r&&l.saveNewRow(),i=u}}function s(){for(var a=l.tabContainer.find(".nav.nav-tabs"),t=!0,r=0;r<l.tumlTabViewManagers.length;r++){var i=e("#li"+l.tumlTabViewManagers[r].tabId);t?a.append(i):i.insertAfter(a),a=i,t=!1}}function o(e,a){if(void 0==a)return null;for(var t=0;t<a.properties.length;t++){var r=a.properties[t];if(r.qualifiedName==e)return r}return alert("Property navigatingTo not found!!!"),null}this.TumlMainViewManager="1.0.0";var l=this;this.uiManager=t;var d,m,h,T;this.contextVertexId=-1;var p=!0;this.globalOneToOneIndex=new a,this.qualifiedName=null,this.tumlActiveTabViewManager=null,this.setFocus=function(e){e==Tuml.FocusEnum.LEFT_MENU?r.setFocus():this.tumlTabViewManagers[0].setFocus(e==Tuml.FocusEnum.TOP_CONTEXT?e:e)},this.refreshQueryMenuCss=function(e,a){r.refreshQueryMenuCss(e,a)},this.refreshDiagramCss=function(e,a){r.refreshDiagramCss(e,a)},this.refresh=function(a,t){var r=t[0].meta.to,i=t[0].meta.from;if(this.propertyNavigatingTo=void 0==i?null:o(t[0].meta.qualifiedName,i),null!=this.propertyNavigatingTo&&(this.propertyNavigatingTo.oneToMany||this.propertyNavigatingTo.manyToMany))this.qualifiedName=t[0].meta.qualifiedName,this.tumlUri=a,this.tabContainerProperty=this.propertyNavigatingTo,this.handleMany(i,r,t);else{for(var u=!1,s=0;s<t.length;s++)if(null!==t[s].data){u=!0;break}var l=u===!1;if(l){if(!this.propertyNavigatingTo.composite)return alert("Property "+this.propertyNavigatingTo.name+" has no data and can not be created as it is not composite!"),!1;this.qualifiedName=t[0].meta.qualifiedName,this.tumlUri=a,this.tabContainerProperty=this.propertyNavigatingTo,this.handleOneForCreation(i,r,t)}else this.qualifiedName=t[0].meta.qualifiedName,this.tumlUri=a,this.tabContainerProperty=this.propertyNavigatingTo,r=this.handleOneNotForCreation(t)}return d=null==this.contextVertexId?"/"+tumlModelName+"/oclExecuteQuery":"/"+tumlModelName+"/"+this.contextVertexId+"/oclExecuteQuery",m=n(r,i)?"/"+tumlModelName+"/baseumlgwithquerys/"+this.contextVertexId+"/instanceQuery":"",h="/"+tumlModelName+"/classquery/"+this.contextVertexId+"/query",T="/"+tumlModelName+"/rootquerys",void 0!=this.contextVertexId&&-1!==this.contextVertexId&&p?this.addDefaultQueryTab():this.addRootQueryTab(),this.tumlTabViewManagers[0].activated||(this.tumlTabViewManagers[0].activated=!0,this.tumlTabViewManagers[0].activeOpenTabsGrid(),this.tumlTabViewManagers[0].addOrRemoveSelectButton()),this.tumlTabViewManagers[0].open=!0,this.tabContainer.find("a:first").tab("show"),this.updateNavigationHeader(this.qualifiedName),e("body").layout().resizeAll(),!0},this.handleMany=function(a,t,n){var s=retrieveVertexId(this.tumlUri),o=this.clearTabsOnAddOneOrMany(s);r.refresh(a,t,this.contextVertexId,this.propertyNavigatingTo),u(this.tumlUri,n,!1),i(o),this.tabContainer.find('a[data-toggle="tab"]').on("shown.bs.tab",function(){e("#tabs-layoutpanelPanelDefault").children(".umlg-panel-footer.panel-footer").show()})},this.handleOneNotForCreation=function(e){for(var a,t=0;t<e.length;t++)if(null!==e[t].data){a=e[t].meta.to,this.qualifiedName=e[t].meta.qualifiedName;var n=e[t].data.id,u=this.clearTabsOnAddOneOrMany(n);r.refresh(a,a,this.contextVertexId);var s=this.createTabContainer(tuml.tab.Enum.Properties,e[t],this.tumlUri,{forLookup:!1,forManyComponent:!1,isOne:!0,forCreation:!1},this.propertyNavigatingTo);this.addToTumlTabViewManagers(s),s.createTab(e[t],!1),i(u);break}return a},this.handleTabActivate=function(a){var t=a.target.offsetParent,r=this.tabContainer.find("#"+t.id.substring(2));if(l instanceof Tuml.TumlMainViewManager){var i=e.data(r[0],"tabEnum");if(i!=tuml.tab.Enum.Diagrams){var n=e.data(r[0],"queryId");(void 0===n||null===n)&&(n=-1),l.refreshQueryMenuCss(n,i)}else{var u=e.data(r[0],"diagramName");l.refreshDiagramCss(u,i)}}if(l.deactivateGrids(),void 0!==a.relatedTarget)for(var s=a.relatedTarget.offsetParent,o=this.tabContainer.find("#"+s.id.substring(2)),d=0;d<l.tumlTabViewManagers.length;d++){var m=l.tumlTabViewManagers[d];if(void 0!==o[0]&&o[0].id==m.getTabId()&&(m.isOpen=!1,void 0!==m.tumlTabGridManager||void 0!==m.tumlTabOneManager)){m.open=!1;break}}for(var h=null,d=0;d<l.tumlTabViewManagers.length;d++){var m=l.tumlTabViewManagers[d];if(r[0].id==m.getTabId()){h=m,0===m.tumlTabViewManagers.length&&(m.open=!0);break}}h.isOpen=!0,h.activated||(h.activeOpenTabsGrid(),h.addOrRemoveSelectButton()),h.activated=!1,null!==this.tumlActiveTabViewManager&&(this.tumlActiveTabViewManager.isOpen=!1),this.tumlActiveTabViewManager=h,this.tumlActiveTabViewManager.isOpen=!0},this.handleOneForCreation=function(e,a,t){var n=retrieveVertexId(this.tumlUri),s=this.clearTabsOnAddOneOrMany(n);r.refresh(e,a,this.contextVertexId),u(this.tumlUri,t,!0,!0),i(s)},this.saveViaKeyPress=function(){for(var e=0;e<this.tumlTabViewManagers.length;e++){var a=this.tumlTabViewManagers[e];if(a.saveViaKeyPress())return}},this.doSave=function(a){for(var t=((new Date).getTime(),this.getTumlTabManyOrOneViewManagers(a)),r=[],i={insert:[],update:[],"delete":[]},n=!0,u=0;u<t.length;u++){var s=t[u];if(s instanceof Tuml.TumlTabManyViewManager){var o=this.validateMultiplicity(t);null!==o&&r.push(o);var d=s.tumlTabGridManager.dataView;a&&(r.push.apply(r,s.validateInsert()),r.push.apply(r,s.validateUpdate())),i.insert.push.apply(i.insert,d.getNewItems()),i.update.push.apply(i.update,d.getUpdatedItems()),i.delete.push.apply(i.delete,d.getDeletedItems())}else{if(n=!1,!s.oneManyOrQuery.forCreation){null==this.propertyNavigatingTo?(i=s.tumlTabOneManager.data,a&&r.push.apply(r,s.validateUpdate())):(i.update.push(s.tumlTabOneManager.data),a&&r.push.apply(r,s.validateUpdate()));break}if(s.open){i.insert.push(s.tumlTabOneManager.data),a&&r.push.apply(r,s.validateInsert());break}}}if(a&&r.length>0){for(var m="",u=0;u<r.length;u++){var h=r[u];m+=h.toString()}return void alert(m)}var T;T=a?l.tumlUri:l.tumlUri+"?rollback=true";var p;p=null==this.propertyNavigatingTo?"PUT":"POST",e.ajax({url:T,type:p,dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(e){a?l.updateTabsForResultAfterCommit(e):l.updateTabsForResultAfterRollback(e)},error:function(a){e("#serverErrorMsg").addClass("server-error-msg").html(a.responseText),e(".top-center").notify({message:{text:"Failure"}}).show()}})},this.updateTabsForResultAfterCommit=function(e){for(var a=0;a<e.length;a++){for(var t=e[a],r=t.meta.to,i=[],n=0;n<this.tumlTabViewManagers.length;n++){var u=this.tumlTabViewManagers[n];if(u instanceof Tuml.TumlTabManyViewManager){if(u.beginUpdate(),u.tabId==r.name)for(var s=0;s<t.data.length;s++)this.clearComponentAndAssociationClassTmpId(t.data[s],r,!0),u.updateGridAfterCommit(t.data[s]);u.endUpdate(!1)}else if(u instanceof Tuml.TumlTabOneViewManager){if(e.length>1)throw"result array from server can not be bigger than one for a one!";u.tabId==r.name?(u.beginUpdate(),this.clearComponentAndAssociationClassTmpId(t.data,r,!0),u.updateGridAfterCommit(t.data),u.endUpdate(!0)):i.push(n)}}for(var n=0;n<i.length>0;n++){var o=i[n];this.tumlTabViewManagers[o].closeTab()}}for(var n=0;n<this.tumlTabViewManagers.length;n++){var u=this.tumlTabViewManagers[n];u instanceof Tuml.TumlTabManyViewManager&&u.clearArraysAfterCommit()}},this.updateTabsForResultAfterRollback=function(e){for(var a=0;a<e.length;a++)for(var t=e[a],r=t.meta.to,i=0;i<this.tumlTabViewManagers.length;i++){var n=this.tumlTabViewManagers[i];if(n instanceof Tuml.TumlTabManyViewManager){if(n.beginUpdate(),n.tabId==r.name)for(var u=0;u<t.data.length;u++)this.setComponentIdToTmpId(t.data[u],r),n.updateGridAfterRollback(t.data[u]);n.endUpdate(!0)}else n.tabId==r.name&&(n.beginUpdate(),this.setComponentIdToTmpId(t.data,r),n.updateGridAfterRollback(t.data),n.endUpdate(!0))}},this.validateMultiplicity=function(e){for(var a=0,t=0;t<e.length;t++){var r=e[t];if(!(r instanceof Tuml.TumlTabManyViewManager)){a=1;break}var i=r.tumlTabGridManager.dataView;a+=i.getItems().length}if(a<this.tabContainerProperty.lower||-1!==this.tabContainerProperty.upper&&a>this.tabContainerProperty.upper){var n=new Tuml.ValidationResult(-1,this.tabContainerProperty.name);return n.property=this.tabContainerProperty,n.qualifiedName=this.tabContainerProperty.qualifiedName,n.message="multiplicity falls outside the valid range ["+this.tabContainerProperty.lower+".."+(-1!==this.tabContainerProperty.upper?this.tabContainerProperty.upper:"*")+"]",n}return null},this.clearTabsOnAddOneOrMany=function(e){if(p=void 0===e&&-1===this.contextVertexId?!0:-1===this.contextVertexId&&null===e?!0:-1===this.contextVertexId&&void 0===e?!0:e!==this.contextVertexId,this.contextVertexId=e,p)this.destroyTabContainer(),this.maybeCreateTabContainer();else{this.removeMultiplicityWarningHeader();for(var a=[],t=0;t<this.tumlTabViewManagers.length;t++){var r=this.tumlTabViewManagers[t];(r instanceof Tuml.TumlTabOneViewManager||r instanceof Tuml.TumlTabManyViewManager)&&a.push(r)}for(var t=0;t<a.length;t++)a[t].closeTab(),this.tabLayoutTabFooterDiv.empty()}this.addButtons();for(var i=[],t=0;t<this.tumlTabViewManagers.length;t++){var r=this.tumlTabViewManagers[t];i.push(r)}return i},this.addQueryTab=function(e,a){for(var t,r=0,i=0;i<this.tumlTabViewManagers.length;i++)if(this.tumlTabViewManagers[i].tabId==a.getDivName()){t=this.tumlTabViewManagers[i],r=i;break}return void 0===t&&(t=void 0===a.queryType||null===a.queryType?new Tuml.TumlTabQueryViewManager(tuml.tab.Enum.Properties,this.tabContainer,m,h,T,a.getDivName(),a.name,a.id):"instanceQuery"===a.queryType?new Tuml.TumlTabQueryViewManager(tuml.tab.Enum.InstanceQueries,this.tabContainer,m,"","",a.getDivName(),a.name,a.id):"classQuery"===a.queryType?new Tuml.TumlTabQueryViewManager(tuml.tab.Enum.ClassQueries,this.tabContainer,"",h,"",a.getDivName(),a.name,a.id):new Tuml.TumlTabQueryViewManager(tuml.tab.Enum.RootQueries,this.tabContainer,"","",T,a.getDivName(),a.name,a.id),t.createTab(e),t.parentTabContainerManager=this,-1===a.id?(this.tumlTabViewManagers.push(t),s()):(this.tumlTabViewManagers.splice(this.tumlTabViewManagers.length-1,0,t),s()),t.createQuery(d,a,e),t.showInlineForm(),null!==this.tumlActiveTabViewManager&&(this.tumlActiveTabViewManager.isOpen=!1),this.tumlActiveTabViewManager=t,this.tumlActiveTabViewManager.isOpen=!0),t},this.addDiagramTab=function(e){for(var a,t=0,r=0;r<this.tumlTabViewManagers.length;r++)if(this.tumlTabViewManagers[r].tabId==e.name){a=this.tumlTabViewManagers[r],t=r;break}return void 0===a?(a=new Tuml.TumlTabDiagramViewManager(tuml.tab.Enum.Diagrams,this.tabContainer,e.name,e.name),a.createTab(),a.parentTabContainerManager=this,this.tumlTabViewManagers.splice(this.tumlTabViewManagers.length-1,0,a),s()):this.tabContainer.children("ul").find("li:eq("+l.tumlTabViewManagers.indexOf(a)+") a").tab("show"),a.createDiagram(e.path,e.type),a},this.afterSaveInstance=function(e,a){this.addDefaultQueryTab(!1);var t=this.addQueryTab(!1,new Tuml.Query(e.query.id,e.query.name,e.query.name,e.query.queryString,e.query.queryEnum,e.gridData,e.queryType)),i=l.tumlTabViewManagers.indexOf(t);this.tumlTabViewManagers.splice(i,1),this.tumlTabViewManagers.splice(a,0,t),r.refreshInstanceQuery(e.query.id)},this.afterUpdateInstance=function(e){this.addQueryTab(!1,new Tuml.Query(e.query.id,e.query.name,e.query.name,e.query.queryString,e.query.queryEnum,e.gridData,e.queryType)),r.refreshInstanceQuery(e.query.id)},this.afterDeleteInstance=function(e){r.deleteInstanceQuery(e.query.id)},this.afterSaveClassQuery=function(e,a){this.addDefaultQueryTab(!1);var t=this.addQueryTab(!1,new Tuml.Query(e.query.id,e.query.name,e.query.name,e.query.queryString,e.query.queryEnum,e.gridData,e.queryType)),i=l.tumlTabViewManagers.indexOf(t);this.tumlTabViewManagers.splice(i,1),this.tumlTabViewManagers.splice(a,0,t),r.refreshClassQuery(e.query.id)},this.afterUpdateClassQuery=function(e){this.addQueryTab(!1,new Tuml.Query(e.query.id,e.query.name,e.query.name,e.query.queryString,e.query.queryEnum,e.gridData,e.queryType)),r.refreshClassQuery(e.query.id)},this.afterDeleteClassQuery=function(e){r.deleteClassQuery(e.query.id)},this.afterSaveRootQuery=function(e,a){this.addDefaultQueryTab(!1);var t=this.addQueryTab(!1,new Tuml.Query(e.query.id,e.query.name,e.query.name,e.query.queryString,e.query.queryEnum,e.gridData,e.queryType)),i=l.tumlTabViewManagers.indexOf(t);this.tumlTabViewManagers.splice(i,1),this.tumlTabViewManagers.splice(a,0,t),r.refreshRootQuery(e.query.id)},this.afterUpdateRootQuery=function(e){this.addQueryTab(!1,new Tuml.Query(e.query.id,e.query.name,e.query.name,e.query.queryString,e.query.queryEnum,e.gridData,e.queryType)),r.refreshRootQuery(e.query.id)},this.afterDeleteRootQuery=function(e){r.deleteRootQuery(e.query.id)},this.addDefaultQueryTab=function(){this.addQueryTab(!0,new Tuml.Query(-1,"New Query","New Query Description","self.name","ocl",null,null))},this.addRootQueryTab=function(){null!==this.contextVertexId&&void 0!==this.contextVertexId||null!==this.propertyNavigatingTo&&void 0!==this.propertyNavigatingTo?this.addQueryTab(!0,new Tuml.Query(-1,"New Query","New Query Description","self.name","ocl",null,"rootQuery")):this.addQueryTab(!0,new Tuml.Query(-1,"New Query","New Query Description","self.name","groovy",null,"rootQuery"))},Tuml.TumlTabContainerManager.call(this,this.tabContainer)}e.extend(!0,window,{Tuml:{TumlMainViewManager:t,TumlFakeIndex:0,GlobalOneToOneIndex:a}}),t.prototype=new Tuml.TumlTabContainerManager,t.prototype.nestedCount=function(e){return e},t.prototype.refreshContext=function(e){this.uiManager.refresh(e)},t.prototype.addToOneToOneIndex=function(e,a){this.globalOneToOneIndex.addToOneToOneIndex(e,a)},t.prototype.updateDataModelForOneToOne=function(e,a,t){var r=this.globalOneToOneIndex.getIndex(e);if(null!==r)for(var i=0;i<this.tumlTabViewManagers.length;i++){var n=this.tumlTabViewManagers[i];n instanceof Tuml.TumlTabManyViewManager&&n.updateOne(e,a,t,r)}},t.prototype.updateDataModelForOneToOneForUpdatedItem=function(e,a,t,r,i){for(var n=0;n<this.tumlTabViewManagers.length;n++){var u=this.tumlTabViewManagers[n];u instanceof Tuml.TumlTabManyViewManager&&u.tumlTabGridManager.localMetaForData.qualifiedName!==e&&u.updateOneForUpdate(a,t,r,i)}},t.prototype.doCancel=function(){this.enableButtons(),Slick.GlobalEditorLock.cancelCurrentEdit(),this.uiManager.refresh(this.tumlUri)},t.prototype.saveTabs=function(){this.doSave(!0)},t.prototype.getTabId=function(){return"tabs-layout"},t.prototype.saveNewRow=function(){this.doSave(!1)},t.prototype.handleLookup=function(a,t,r){for(var i,n=((new Date).getTime(),this.getTumlTabManyOrOneViewManagers(!1)),u={insert:[],update:[],"delete":[]},s=0;s<n.length;s++){var o=n[s];if(!(o instanceof Tuml.TumlTabManyViewManager)||o.oneManyOrQuery.forManyComponent){i=null==this.propertyNavigatingTo?"PUT":"POST",u=o.tumlTabOneManager.data;break}if(i="POST",!o.oneManyOrQuery.forManyComponent){var l=o.tumlTabGridManager.dataView;u.insert.push.apply(u.insert,l.getNewItems()),u.update.push.apply(u.update,l.getUpdatedItems()),u.delete.push.apply(u.delete,l.getDeletedItems())}}var d;d="POST"===i?this.tumlUri+"_forwardToLookup?lookupUri="+a+"&qualifiedName="+t:this.tumlUri+"/forwardToLookup?lookupUri="+a+"&qualifiedName="+t,e.ajax({url:d,type:i,dataType:"json",contentType:"application/json",data:JSON.stringify(u),success:function(e){if(Array.isArray(e)){for(var a=[],i=0;i<e.length;i++){var n=e[i];if(n.meta.to.qualifiedName===t){for(var u=0;u<n.data.length;u++){var s=n.data[u];void 0!==s.tmpId&&null!==s.tmpId&&(s.id=s.tmpId)}a.push(n)}}r(a)}else{for(var u=0;u<e.data.length;u++){var s=e.data[u];void 0!==s.tmpId&&null!==s.tmpId&&(s.id=s.tmpId)}r(e.data)}},error:function(a){e("#serverErrorMsg").addClass("server-error-msg").html(a.responseText)}})}}(jQuery);