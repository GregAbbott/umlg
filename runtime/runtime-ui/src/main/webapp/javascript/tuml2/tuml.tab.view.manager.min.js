!function(a){function e(e,t,n,i,r){this.TumlBaseTabViewManager="1.0.0",this.backupData=null,this.activated=!1,this.isOpen,this.tabEnum=e,this.open=!1,this.showInlineForm=function(){this.parentTabContainerManager.tabLayoutTabFooterDiv.find(".btn-toolbar").hide(),this.parentTabContainerManager.tabLayoutTabFooterDiv.find(".form-inline").show()},this.hideInlineForm=function(){this.parentTabContainerManager.tabLayoutTabFooterDiv.find(".form-inline").hide(),this.parentTabContainerManager.tabLayoutTabFooterDiv.find(".btn-toolbar").show()},this.disableTab=function(){a("#tab-container").tabs("disableTab",this.tabTitleName)},Tuml.TumlTabContainerManager.call(this,t,r),void 0!==this.result&&this.init(n,i),this.handleLookup=function(a,e,t){this.parentTabContainerManager.handleLookup(a,e,t)}}function t(a,t,n,i,r,o,l,s){this.TumlTabQueryViewManager="1.0.0",void 0!==s&&(this.queryId=s),this.tabId=o,this.tabTitleName=l,this.tumlTabQueryManager=new Tuml.TumlTabQueryManager(this,n,i,r,this.queryId),this.createQuery=function(a,e,t){this.tumlTabQueryManager.createQuery(this.tabId,a,e,t)},this.afterSaveInstance=function(a){var e=this.parentTabContainerManager.tumlTabViewManagers.indexOf(this);this.closeTab(),this.parentTabContainerManager.afterSaveInstance(a,e)},this.afterUpdateInstance=function(a){this.updateTabTitle(a.query.name),this.parentTabContainerManager.afterUpdateInstance(a)},this.afterDeleteInstance=function(a){this.parentTabContainerManager.afterDeleteInstance(a),this.closeTab()},this.afterSaveClassQuery=function(a){var e=this.parentTabContainerManager.tumlTabViewManagers.indexOf(this);this.closeTab(),this.parentTabContainerManager.afterSaveClassQuery(a,e)},this.afterUpdateClassQuery=function(a){this.updateTabTitle(a.query.name),this.parentTabContainerManager.afterUpdateClassQuery(a)},this.afterDeleteClassQuery=function(a){this.parentTabContainerManager.afterDeleteClassQuery(a),this.closeTab()},this.afterSaveRootQuery=function(a){var e=this.parentTabContainerManager.tumlTabViewManagers.indexOf(this);this.closeTab(),this.parentTabContainerManager.afterSaveRootQuery(a,e)},this.afterUpdateRootQuery=function(a){this.updateTabTitle(a.query.name),this.parentTabContainerManager.afterUpdateRootQuery(a)},this.afterDeleteRootQuery=function(a){this.parentTabContainerManager.afterDeleteRootQuery(a),this.closeTab()},e.call(this,a,t),this.showInlineForm=function(){this.parentTabContainerManager.showInlineForm(),this.parentTabContainerManager.showCorrectQueryButtons(this.tumlTabQueryManager.query)},this.hideInlineForm=function(){this.parentTabContainerManager.hideInlineForm()}}function n(a,t,n,i){this.TumlTabDiagramViewManager="1.0.0",this.tabId=n,this.tabTitleName=i,this.tumlTabDiagramManager=new Tuml.TumlTabDiagramManager(this),e.call(this,a,t),this.createDiagram=function(a,e){this.tumlTabDiagramManager.createDiagram(this.tabId,a,e)}}function r(a,t,n,i,r,o){this.TumlTabOneViewManager="1.0.0",this.oneManyOrQuery=n,this.result=r,this.setComponentProperty=function(a){this.componentProperty=a},this.setFocus=function(){this.li.focus()},e.call(this,a,t,i,r,o),this.showInlineForm=function(){this.parentTabContainerManager.showInlineForm()},this.hideInlineForm=function(){this.parentTabContainerManager.hideInlineForm()}}function o(a,t,n,i,r,o){this.TumlTabManyViewManager="1.0.0",this.oneManyOrQuery=n,this.result=r,this.tumlTabGridManager=null,e.call(this,a,t,i,r,o),this.showInlineForm=function(){this.parentTabContainerManager.showInlineForm()},this.hideInlineForm=function(){this.parentTabContainerManager.hideInlineForm()},this.setFocus=function(a){if(a==Tuml.FocusEnum.CENTER_TAB)this.li.focus();else{if(a!=Tuml.FocusEnum.CENTER_GRID)throw Error("Can not call TumlTabManyViewManager.setFocus for "+a);this.tumlTabGridManager.setFocus()}}}function l(a,e,t,n,i,r){this.TumlTabManyComponentViewManager="1.0.0",o.call(this,a,e,t,n,i,r)}a.extend(!0,window,{Tuml:{TumlBaseTabViewManager:e,TumlTabOneViewManager:r,TumlTabManyComponentViewManager:l,TumlTabManyViewManager:o,TumlTabQueryViewManager:t,TumlTabDiagramViewManager:n}}),e.prototype=new Tuml.TumlTabContainerManager,e.prototype.passOnValidationResults=function(a,e,t){var n=[];if(null!==this.validationResults){for(var i=0;i<this.validationResults.length;i++){var r=this.validationResults[i];if(r.row==e&&r.property==t){for(var o=0;o<r.validationResults.length;o++){var l=r.validationResults[o];l.validationResults.length>0&&(a.validationResults=r.validationResults)}n.push(i)}}for(var i=0;i<n.length;i++)this.validationResults.splice(n[i],1)}},e.prototype.getTabId=function(){return this.tabId},e.prototype.validateUpdate=function(){throw"TumlBaseTabViewManager.prototype.validateUpdate must be overriden"},e.prototype.closeTab=function(){this.clearAllTabs(),a("#"+this.tabId).remove(),this.li.remove();var e=this.parentTabContainerManager.tumlTabViewManagers.indexOf(this);this.parentTabContainerManager.tumlTabViewManagers.splice(e,1)},e.prototype.updateTabTitle=function(a){this.li.find("a").text(a)},e.prototype.saveAndCloseTab=function(){this.saveAndClearAllTabs(),this.parentTabContainerManager.setCellValue(this.tumlTabGridManager.dataView.getItems()),a("#"+this.tabId).remove(),this.li.remove();var e=this.parentTabContainerManager.tumlTabViewManagers.indexOf(this);this.parentTabContainerManager.tumlTabViewManagers.splice(e,1)},e.prototype.init=function(a,e){this.metaForData=e.meta},e.prototype.createTab=function(){var e,t=this;e=this.parentTabContainerManager instanceof Tuml.TumlMainViewManager?"<li id='li"+this.tabId+"'><a href='#{href}' data-toggle='tab'>#{label}</a>":"<li id='li"+this.tabId+"'><a href='#{href}' data-toggle='tab'>#{label}</a></li>";var n=this.tabTitleName;this.li=a(e.replace(/#\{href\}/g,"#"+this.tabId).replace(/#\{label\}/g,n)),this.parentTabContainer.children("ul").append(this.li);var i=a("<div />",{id:this.tabId,"class":"umlg-tab tab-pane"});return this.parentTabContainer.children("div.tab-content").append(i),this.li.children("a:first").tab("show"),a.data(i[0],"tabEnum",this.tabEnum),this.li.find('a[href="#'+this.tabId+'"]').on("shown.bs.tab",function(a){t.hideInlineForm(),t.parentTabContainerManager.handleTabActivate(a)}),i},e.prototype.getTabData=function(){alert("This must be overriden")},e.prototype.openManyComponent=function(){throw"TumlBaseTabViewManager.prototype.openManyComponent must be overriden"},e.prototype.openOneComponent=function(){throw"TumlBaseTabViewManager.prototype.openOneComponent must be overriden"},e.prototype.saveNewRow=function(){if(this.parentTabContainerManager.updateMultiplicityWarningHeader(),this.tumlTabViewManagers.length>0){var a=null,e=this.tumlTabViewManagers[0];if(e instanceof r)a=e.getTabData();else{a=[];for(var t=0;t<this.tumlTabViewManagers.length;t++){var e=this.tumlTabViewManagers[t];a.push.apply(a,e.getTabData())}}this.setCellValue(a)}this.parentTabContainerManager.saveNewRow()},e.prototype.updateGridAfterCommit=function(a){for(var e=0;e<this.tumlTabViewManagers.length;e++){var t=this.tumlTabViewManagers[e];t.beginUpdate();var n=a[t.propertyNavigatingTo.name];if(t instanceof r)t.updateGridAfterCommit(n);else for(var i=0;i<n.length;i++){var o=n[i];t.metaForData.to.qualifiedName===o.qualifiedName&&t.updateGridAfterCommit(o)}t.endUpdate(!0)}},e.prototype.updateGridAfterRollback=function(a){for(var e=0;e<this.tumlTabViewManagers.length;e++){var t=this.tumlTabViewManagers[e];t.beginUpdate();var n=a[t.propertyNavigatingTo.name];if(t instanceof r)t.updateGridAfterRollback(n);else for(var i=0;i<n.length;i++){var o=n[i];t.metaForData.to.qualifiedName===o.qualifiedName&&t.updateGridAfterRollback(o)}t.endUpdate(!0)}},e.prototype.beginUpdate=function(){},e.prototype.endUpdate=function(){},t.prototype=new Tuml.TumlBaseTabViewManager,t.prototype.saveViaKeyPress=function(){return this.open?!0:e.prototype.saveViaKeyPress.call(this)},t.prototype.cancelViaKeyPress=function(){return this.open?!0:e.prototype.cancelViaKeyPress.call(this)},t.prototype.closeTab=function(a){var t=this.parentTabContainerManager.tumlTabViewManagers.indexOf(this);e.prototype.closeTab.call(this),a||this.tabUl.find("li:eq("+t+") a").tab("show")},t.prototype.createTab=function(e){var t,n=this;t=this.parentTabContainerManager instanceof Tuml.TumlMainViewManager?"<li id='li"+this.tabId+"'><a href='#{href}' data-toggle='tab'>#{label}</a>":e?"<li id='li"+this.tabId+"'><a href='#{href}' data-toggle='tab'>#{label}</a></li>":"<li id='li"+this.tabId+"'><a href='#{href}' data-toggle='tab'>#{label} <span class='umlg-query-tab glyphicon glyphicon-remove'></span></a></li>";var i=this.tabTitleName,r=this.tabId;this.li=a(t.replace(/#\{href\}/g,"#"+r).replace(/#\{label\}/g,i)),e||this.li.find("span.umlg-query-tab").click(function(){Slick.GlobalEditorLock.commitCurrentEdit()&&n.closeTab()}),this.tabUl=this.parentTabContainer.children("ul"),this.tabUl.append(this.li);var o=a("<div />",{id:this.tabId,"class":"umlg-tab tab-pane"});return this.parentTabContainer.children(".tab-content").append(o),a.data(o[0],"tabEnum",this.tabEnum),this.tabUl.find("a:last").tab("show"),this.tabUl.find("a[href='#"+r+"']").on("shown.bs.tab",function(e){n.showInlineForm(),n.parentTabContainerManager.handleTabActivate(e);a("#queryLayoutDiv").layout().resizeAll()}),void 0!==this.queryId&&a.data(o[0],"queryId",this.queryId),o},n.prototype=new Tuml.TumlBaseTabViewManager,n.prototype.createTab=function(){var e,t=this;e=this.parentTabContainerManager instanceof Tuml.TumlMainViewManager?"<li id='li"+this.tabId+"'><a href='#{href}' data-toggle='tab'>#{label}</a>":"<li id='li"+this.tabId+"'><a href='#{href}' data-toggle='tab'>#{label} <span class='umlg-diagram-tab glyphicon glyphicon-remove'></span></a></li>";var n=this.tabTitleName,i=this.tabId;this.li=a(e.replace(/#\{href\}/g,"#"+i).replace(/#\{label\}/g,n)),this.li.find("span.umlg-diagram-tab").click(function(){Slick.GlobalEditorLock.commitCurrentEdit()&&t.closeTab()}),this.tabUl=this.parentTabContainer.children("ul"),this.tabUl.append(this.li);var r=a("<div />",{id:this.tabId,"class":"umlg-tab tab-pane"});return this.parentTabContainer.children(".tab-content").append(r),a.data(r[0],"tabEnum",this.tabEnum),this.tabUl.find("a:last").tab("show"),this.tabUl.find("a[href='#"+i+"']").on("shown.bs.tab",function(a){t.parentTabContainerManager.handleTabActivate(a)}),a.data(r[0],"diagramName",this.tabTitleName),r},n.prototype.closeTab=function(){var a=this.parentTabContainerManager.tumlTabViewManagers.indexOf(this);e.prototype.closeTab.call(this),this.tabUl.find("li:eq("+a+") a").tab("show")},r.prototype=new Tuml.TumlBaseTabViewManager,r.prototype.saveViaKeyPress=function(){return this.open?(this.commitCurrentEdit(),this.parentTabContainerManager.saveTabs(),!0):e.prototype.saveViaKeyPress.call(this)},r.prototype.cancelViaKeyPress=function(){return this.open?(this.parentTabContainerManager.doCancel(),!0):e.prototype.cancelViaKeyPress.call(this)},r.prototype.createTab=function(a,t){this.oneManyOrQuery.forOneComponent?(this.tabId=this.result.meta.to.name+"OneComponent",this.tabTitleName=this.result.meta.to.name):(this.tabId=this.result.meta.to.name,this.tabTitleName=this.result.meta.to.name),e.prototype.createTab.call(this),this.createOne(a.data,t)},r.prototype.disableButtons=function(){var a=this.tabContainer.find(".ui-tabs-nav");a.find("#"+this.getTabId()+"save").attr("disabled","disabled")},r.prototype.enableButtons=function(){var a=this.tabContainer.find(".ui-tabs-nav");a.find("#"+this.getTabId()+"save").removeAttr("disabled")},r.prototype.commitCurrentEdit=function(){this.tumlTabOneManager.commitCurrentEdit()},r.prototype.doCancel=function(){Tuml.TumlTabContainerManager.prototype.doInternalCancel.call(this),a("#formDiv"+this.tabTitleName).show(),this.open=!0},r.prototype.validateUpdate=function(){var a=[],e=this.getTabData();if(this.metaForData.qualifiedName==e.qualifiedName)for(var t=0;t<this.metaForData.to.properties.length;t++){var n=this.metaForData.to.properties[t];if(!n.composite&&!n.inverseComposite&&n.lower>0)if(-1===n.upper||n.upper>1){if(0===e[n.name].length){var i=new Tuml.ValidationResult(0,n.name);i.message=n.name+" is a required field!",a.push(i)}}else if(null==e[n.name]){var i=new Tuml.ValidationResult(0,n.name);i.message=n.name+" is a required field!",a.push(i)}}return a},r.prototype.validateInsert=function(){var a=[],e=this.getTabData();if(this.metaForData.qualifiedName==e.qualifiedName)for(var t=0;t<this.metaForData.to.properties.length;t++){var n=this.metaForData.to.properties[t];if(!n.inverseComposite&&n.lower>0)if(-1===n.upper||n.upper>1){if(void 0==e[n.name]||0===e[n.name].length){var i=new Tuml.ValidationResult(0,n.name);i.row=0,i.property=n,i.qualifiedName=n.qualifiedName,i.message=n.name+" is a required field!",a.push(i)}}else if(null==e[n.name]){var i=new Tuml.ValidationResult(0,n.name);i.row=0,i.property=n,i.qualifiedName=n.qualifiedName,i.message=n.name+" is a required field!",a.push(i)}}if(null!=this.validationResults)for(var r=0;r<this.validationResults.length;r++){var o=this.validationResults[r];a.push(o)}return a},r.prototype.getTabData=function(){return this.tumlTabOneManager.data},r.prototype.updateGridAfterCommit=function(a){this.tumlTabOneManager.updateGridAfterCommitOrRollback(a),e.prototype.updateGridAfterCommit.call(this,a),this.oneManyOrQuery.forCreation=!1,this.tumlTabOneManager.isForCreation=!1},r.prototype.updateGridAfterRollback=function(a){this.tumlTabOneManager.updateGridAfterCommitOrRollback(a),e.prototype.updateGridAfterRollback.call(this,a)},r.prototype.init=function(a,t){e.prototype.init.call(this,a,t),this.tumlTabOneManager=this.oneManyOrQuery.forOneComponent?new Tuml.TumlTabComponentOneManager(this):new Tuml.TumlTabOneManager(this)},r.prototype.addToCellValue=function(a){this.tumlTabOneManager.addToCellValue(this.property,a)},r.prototype.createOne=function(a,e){this.tumlTabOneManager.refresh(a,this.metaForData,e)},r.prototype.setComponentProperty=function(a){this.tumlTabOneManager.setComponentProperty(a)},r.prototype.setCellValue=function(a){this.tumlTabOneManager.updateData(this.componentProperty,a),this.tumlTabOneManager.refreshFromDataModel()},r.prototype.openManyComponent=function(e,t,n){var i=this;Tuml.Metadata.Cache.get(n.qualifiedName,n,function(r){var o={meta:null,data:null};i.tabContainerProperty=n;for(var l=null,s=0;s<r.length;s++){o.meta=r[s].meta,i.maybeCreateTabContainer(),i.addButtons(),o.data=e;var u=i.createTabContainer(tuml.tab.Enum.Properties,o,t,{forLookup:!1,forManyComponent:!0,forOneComponent:!1,isOne:!1,forCreation:!0},n);i.setComponentProperty(n),i.addToTumlTabViewManagers(u),u.parentTabContainerManager=i;var d=a("#"+i.parentTabContainerManager.getTabId()+"panelPanelDefault"),p=d.find(".tab-content");p.hide(),d.children(".umlg-panel-body.panel-body").height(45);var h=d.find(".umlg-panel-footer.panel-footer");h.hide(),u.backupData=a.extend(!0,[],e),i.passOnValidationResults(u,0,i.tabContainerProperty.name),u.createTab(o,!1),0===s&&(l=u)}i.open=!1;var m=n.qualifiedName;i.updateNavigationHeader(m),i.updateMultiplicityWarningHeader()})},r.prototype.setValidationResults=function(a,e,t){null==this.validationResults&&(this.validationResults=[]);var n=new Tuml.ValidationResult(0,this.tabContainerProperty.name);n.qualifiedName=a,n.validationResults=e,n.multiplicity=t,this.validationResults.push(n)},r.prototype.openOneComponent=function(e,t,n,i){var r=this;Tuml.Metadata.Cache.get(i.qualifiedName,i,function(o){var l={meta:null,data:null};r.tabContainerProperty=i;for(var s=null,u=0;u<o.length;u++){l.meta=o[u].meta,r.maybeCreateTabContainer(),r.addButtons(),l.data=e;var d=r.createTabContainer(tuml.tab.Enum.Properties,l,n,{forLookup:!1,forManyComponent:!1,forOneComponent:!0,isOne:!0,forCreation:!0},i);r.setCell(t),r.addToTumlTabViewManagers(d),d.parentTabContainerManager=r;var p=a("#"+r.parentTabContainerManager.getTabId()+"panelPanelDefault"),h=p.find(".tab-content");h.hide();var m=p.find(".umlg-panel-footer.panel-footer");m.hide(),d.backupData=a.extend(!0,{},l.data),void 0===l.data.id||null===l.data.id?(d.createTab(l,!0),r.saveNewRow(),d.tumlTabOneManager.containsOneToOne&&d.parentTabContainerManager.addToOneToOneIndex(l.data.id,{})):d.createTab(l,!1),0===u&&(s=d),r.passOnValidationResults(d,0,r.tabContainerProperty.name)}r.open=!1,null!==s&&r.tabContainer.find("a:first").tab("show");var b=i.qualifiedName;r.updateNavigationHeader(b),r.updateMultiplicityWarningHeader()})},r.prototype.saveTabs=function(){Tuml.TumlTabContainerManager.prototype.saveTabs.call(this);var e=a("#"+this.parentTabContainerManager.getTabId()+"panelPanelDefault"),t=e.find(".tab-content");t.show();var n=calculateBodyHeight(this.parentTabContainerManager),i=e.find(".umlg-panel-footer.panel-footer");i.show(),e.children(".umlg-panel-body.panel-body").height(n-10),this.open=!0},o.prototype=new Tuml.TumlBaseTabViewManager,o.prototype.doCancel=function(){this.doInternalCancel.call(this),this.open=!0},o.prototype.validateUpdate=function(){for(var a=[],e=this.tumlTabGridManager.dataView.getUpdatedItems(),t=0;t<e.length;t++){var n=e[t];if(this.metaForData.qualifiedName==n.qualifiedName)for(var i=0;i<this.metaForData.to.properties.length;i++){var r=this.metaForData.to.properties[i];if(!r.composite&&!r.inverseComposite&&r.lower>0)if(-1===r.upper||r.upper>1){if(0===n[r.name].length){var o=new Tuml.ValidationResult(t,r.name);o.message=r.name+" is a required field!",a.push(o)}}else if(null==n[r.name]){var o=new Tuml.ValidationResult(t,r.name);o.message=r.name+" is a required field!",a.push(o)}}}return a},o.prototype.validateInsert=function(){for(var a=[],e=this.tumlTabGridManager.dataView.getNewItems(),t=0;t<e.length;t++){var n=e[t];if(this.metaForData.to.qualifiedName==n.qualifiedName)for(var r=0;r<this.metaForData.to.properties.length;r++){var o=this.metaForData.to.properties[r],l=!1,s=!1;if(o.associationClassOne||o.derived?l=!1:o.memberEndOfAssociationClass&&o.inverseQualifiedName===this.propertyNavigatingTo.qualifiedName?(l=!0,s=!0):!o.inverseComposite&&o.lower>0&&(l=!0),l&&!s)this.validateInsertNonAssociationClass(o,n,t,a);else if(s)if(null==n[o.associationClassPropertyName]){var u=new Tuml.ValidationResult(i,o.name);u.row=this.tumlTabGridManager.dataView.getIdxById(n.id),u.property=o,u.qualifiedName=o.qualifiedName,u.message="The association class for "+o.name+" is required!",a.push(u)}else{for(var d,p=0;p<this.metaForData.to.properties.length&&(d=this.metaForData.to.properties[p],d.name!==o.associationClassPropertyName);p++);var h=!1;if(null!=this.validationResults)for(var m=0;m<this.validationResults.length;m++){var u=this.validationResults[m];if(u.property===d.name){h=!0;break}}if(!h){var b=Tuml.Metadata.Cache.getFromCache(d.qualifiedName);if(void 0===b)throw"Meta data for association class must be available in the cache!";for(var f=0;f<b.length;f++)for(var T=0;T<b[f].meta.to.properties.length;T++){var c=b[f].meta.to.properties[T];!c.associationClassProperty&&c.lower>0&&this.validateInsertNonAssociationClass(c,n[d.name],t,a)}}}}}if(null!=this.validationResults)for(var g=0;g<this.validationResults.length;g++){var y=this.validationResults[g];a.push(y)}return a},o.prototype.validateInsertNonAssociationClass=function(a,e,t,n){if(-1===a.upper||a.upper>1){if(void 0==e[a.name]||0===e[a.name].length){var i=new Tuml.ValidationResult(t,a.name);i.row=this.tumlTabGridManager.dataView.getIdxById(e.id),i.property=a,i.qualifiedName=a.qualifiedName,i.message=a.name+" is a required field!",n.push(i)}}else if(a.onePrimitive||a.manyPrimitive||a.oneEnumeration||null!=a.dataTypeEnum||a.composite||!a.manyToOne&&!a.oneToOne){if(null==e[a.name]){var i=new Tuml.ValidationResult(t,a.name);i.row=this.tumlTabGridManager.dataView.getIdxById(e.id),i.property=a,i.qualifiedName=a.qualifiedName,i.message=a.name+" is a required field!",n.push(i)}}else if(null==e[a.name].id){var i=new Tuml.ValidationResult(t,a.name);i.row=this.tumlTabGridManager.dataView.getIdxById(e.id),i.property=a,i.qualifiedName=a.qualifiedName,i.message=a.name+" is a required field!",n.push(i)}},o.prototype.updateOneForUpdate=function(a,e,t,n){var i=this.tumlTabGridManager.dataView.getItemById(a);void 0!==i&&(i[t].id=n.id,i[t].displayName=e,this.tumlTabGridManager.dataView.updateItem(i.id,i,t),this.tumlTabGridManager.grid.invalidateAllRows(),this.tumlTabGridManager.grid.render())},o.prototype.updateOne=function(a,e,t,n){var i=this.tumlTabGridManager.dataView.getItemById(n.id);this.updateOneRecursive(i,a,e,t,n)},o.prototype.saveViaKeyPress=function(){return this.open?(Slick.GlobalEditorLock.commitCurrentEdit()&&(this.parentTabContainerManager.saveTabs(),this.tumlTabGridManager.grid.focus()),!0):e.prototype.saveViaKeyPress.call(this)},o.prototype.cancelViaKeyPress=function(){return this.open?(Slick.GlobalEditorLock.commitCurrentEdit()&&this.parentTabContainerManager.doCancel(),!0):e.prototype.cancelViaKeyPress.call(this)},o.prototype.updateOneRecursive=function(a,e,t,n,i){var r=a[i.field];if(Array.isArray(r)){for(var o=0;o<r.length;o++){var l=r[o];if(l.id===e)return l[t].id=n.id,l[t].displayName=n.name,console.log("set one to one to in array "+l[t].id+" "+l[t].displayName),!0;if(this.updateOneRecursive(l,e,t,n,i.next))return!0}return!1}if("object"==typeof r){var l=r;return l.id===e?(l[t].id=n.id,l[t].displayName=n.name,console.log("set one to one to from one "+l[t].id+" "+l[t].displayName),!0):this.updateOneRecursive(l,e,t,n,i.next)}return!1},o.prototype.addToOneToOneIndex=function(a,e){var t=this.tumlTabGridManager.dataView.getItem(this.componentCell.row),n=this.tumlTabGridManager.columns[this.componentCell.cell].name,i={id:t.id,field:n,next:e};this.parentTabContainerManager.addToOneToOneIndex(a,i)},o.prototype.deactivateGrids=function(){this.tumlTabGridManager.active=!1,Tuml.TumlTabContainerManager.prototype.deactivateGrids.call(this)},o.prototype.activeOpenTabsGrid=function(){0===this.tumlTabViewManagers.length&&this.open===!0&&(this.tumlTabGridManager.active=!0),Tuml.TumlTabContainerManager.prototype.activeOpenTabsGrid.call(this)},o.prototype.updateGridAfterRollback=function(a){this.tumlTabGridManager.updateGridAfterRollback(a),this.tumlTabViewManagers.length>0&&(void 0!==a.tmpId&&this.tumlTabGridManager.dataView.getItem(this.componentCell.row).tmpId===a.tmpId?e.prototype.updateGridAfterRollback.call(this,a):this.tumlTabGridManager.dataView.getItem(this.componentCell.row).id===a.id&&e.prototype.updateGridAfterRollback.call(this,a))},o.prototype.updateGridAfterCommit=function(a){this.tumlTabGridManager.updateGridAfterCommit(a),this.tumlTabViewManagers.length>0&&this.tumlTabGridManager.dataView.getItem(this.componentCell.row).tmpId===a.tmpId&&e.prototype.updateGridAfterCommit.call(this,a)},o.prototype.clearArraysAfterCommit=function(){this.tumlTabGridManager.clearArraysAfterCommit()},o.prototype.getTabData=function(){return this.tumlTabGridManager.dataView.getItems().length>0?this.tumlTabGridManager.dataView.getItems():[]},o.prototype.beginUpdate=function(){this.tumlTabGridManager.beginUpdate()},o.prototype.endUpdate=function(a){this.tumlTabGridManager.endUpdate(a)},o.prototype.handleDeleteRow=function(){if(this.parentTabContainerManager.updateMultiplicityWarningHeader(),this.tumlTabViewManagers.length>0){for(var a=[],e=0;e<this.tumlTabViewManagers.length;e++){var t=this.tumlTabViewManagers[e];t.tumlTabGridManager.dataView.getItems().length>0&&a.push.apply(a,t.tumlTabGridManager.dataView.getItems())}this.setCellValue(a)}this.parentTabContainerManager.handleDeleteRow()},o.prototype.createTab=function(a,t){if(this.oneManyOrQuery.forLookup?(this.tabId=this.result.meta.to.name+"Lookup",this.tabTitleName=this.result.meta.to.name+" Select"):this.oneManyOrQuery.forManyComponent?(this.tabId=this.result.meta.to.name+"ManyComponent",this.tabTitleName=this.result.meta.to.name):(this.tabId=this.result.meta.to.name,this.tabTitleName=this.result.meta.to.name),e.prototype.createTab.call(this,a,t),this.oneManyOrQuery.forLookup){var n=this.parentTabContainerManager.tabLayoutTabFooterDiv.find(".pull-right"),i=n.find("button:first-child").find("span:first-child");i.removeClass("glyphicon-save"),i.addClass("glyphicon-ok"),i.next("span").text(" Select")}this.createGrid(a)},o.prototype.setCell=function(a){this.componentCell=a},o.prototype.init=function(a,t){e.prototype.init.call(this,a,t),this.tumlTabGridManager=this.oneManyOrQuery.forLookup?new Tuml.TumlForManyLookupGridManager(this,a,this.propertyNavigatingTo):this.oneManyOrQuery.forManyComponent?new Tuml.TumlManyComponentGridManager(this,a,this.propertyNavigatingTo):new Tuml.TumlTabGridManager(this,a,this.propertyNavigatingTo)},o.prototype.addItems=function(a){this.tumlTabGridManager.addItems(a)},o.prototype.setCellValue=function(a){this.tumlTabGridManager.setCellValue(this.componentCell,a)},o.prototype.createGrid=function(e){var t=a("<div />",{id:"slickGrid"+this.tabId,"class":"slickGridOuter"});a("#"+this.tabId).append(t),this.tumlTabGridManager.refresh(e,t)},o.prototype.openManyComponent=function(e,t,n,i){var r=this;Tuml.Metadata.Cache.get(i.qualifiedName,i,function(o){r.tabContainerProperty=i;for(var l=null,s=0;s<o.length;s++){var u={meta:o[s].meta,data:[]};r.maybeCreateTabContainer(),r.addButtons();for(var d=0;d<e.length;d++)e[d].qualifiedName===u.meta.to.qualifiedName&&u.data.push(e[d]);var p=r.createTabContainer(tuml.tab.Enum.Properties,u,n,{forLookup:!1,forManyComponent:!0,forOneComponent:!1,isOne:!1,forCreation:!0},i);r.setCell(t),r.addToTumlTabViewManagers(p),p.parentTabContainerManager=r;var h=a("#"+r.parentTabContainerManager.getTabId()+"panelPanelDefault"),m=h.find(".tab-content");m.hide(),h.children(".umlg-panel-body.panel-body").height(45);var b=h.find(".umlg-panel-footer.panel-footer");b.hide(),p.backupData=a.extend(!0,[],e),r.passOnValidationResults(p,t.row,r.tumlTabGridManager.grid.getColumns()[t.cell].name),p.createTab(u,!1),0===s&&(l=p)}r.open=!1,null!==l&&r.tabContainer.find("a:first").tab("show");var f=i.qualifiedName;r.updateNavigationHeader(f),r.updateMultiplicityWarningHeader()})},o.prototype.openNonCompositeMany=function(e,t){var n=this,i=this.parentTabContainerManager.contextVertexId,r=e.tumlLookupUri.replace(new RegExp("{(s*?.*?)*?}","gi"),i);this.handleLookup(r,t,function(t){for(var i=null,r=0;r<t.length;r++){var o=t[r],l={meta:o.meta,data:o.data};n.maybeCreateTabContainer(),n.addButtons();var s=n.createTabContainer(tuml.tab.Enum.Properties,l,e.tumlUri,{forLookup:!0,forManyComponent:!1,forOneComponent:!1,isOne:!1,forCreation:!1},e);n.addToTumlTabViewManagers(s),s.parentTabContainerManager=n;var u=a("#"+n.parentTabContainerManager.getTabId()+"panelPanelDefault"),d=u.find(".tab-content");d.hide(),u.children(".umlg-panel-body.panel-body").height(45);var p=u.find(".umlg-panel-footer.panel-footer");p.hide(),s.backupData=a.extend(!0,[],t),s.createTab(l,!1),0===r&&(i=s)}n.open=!1,null!==i&&n.tabContainer.find("a:first").tab("show");var h=e.qualifiedName;n.updateNavigationHeader(h)})},o.prototype.setValidationResults=function(a,e,t){null==this.validationResults&&(this.validationResults=[]);var n=new Tuml.ValidationResult(this.componentCell.row,this.tabContainerProperty.name);n.qualifiedName=a,n.validationResults=e,n.multiplicity=t,this.validationResults.push(n)},o.prototype.openOneComponent=function(e,t,n,i){var r=this;Tuml.Metadata.Cache.get(i.qualifiedName,i,function(o){var l={meta:null,data:null};r.tabContainerProperty=i;for(var s=null,u=0;u<o.length;u++){l.meta=o[u].meta,r.maybeCreateTabContainer(),r.addButtons(),l.data=e;var d=r.createTabContainer(tuml.tab.Enum.Properties,l,n,{forLookup:!1,forManyComponent:!1,forOneComponent:!0,isOne:!0,forCreation:!0},i);r.setCell(t),r.addToTumlTabViewManagers(d),d.parentTabContainerManager=r;var p=a("#"+r.parentTabContainerManager.getTabId()+"panelPanelDefault"),h=p.find(".tab-content");h.hide(),p.children(".umlg-panel-body.panel-body").height(45);var m=p.find(".umlg-panel-footer.panel-footer");m.hide(),d.backupData=a.extend(!0,{},l.data),void 0===l.data.id||null===l.data.id?(l.data.id="fake::"+Tuml.TumlFakeIndex++,l.data.tmpId=l.data.id,d.createTab(l,!0),d.saveNewRow(),d.tumlTabOneManager.containsOneToOne&&d.parentTabContainerManager.addToOneToOneIndex(l.data.id,{})):(d.createTab(l,-1!==l.data.id.indexOf("fake")),d.tumlTabOneManager.refreshFromDataModel()),0===u&&(s=d),r.passOnValidationResults(d,t.row,r.tumlTabGridManager.grid.getColumns()[t.cell].name)}r.open=!1,null!==s&&r.tabContainer.find("a:first").tab("show");var b=i.qualifiedName;r.updateNavigationHeader(b),r.updateMultiplicityWarningHeader()})},o.prototype.openAssociationClass=function(e,t,n,i){var r=this;Tuml.Metadata.Cache.get(i.qualifiedName,i,function(o){var l={meta:null,data:null};r.tabContainerProperty=i;for(var s=null,u=0;u<o.length;u++){l.meta=o[u].meta,r.maybeCreateTabContainer(),r.addButtons(),l.data=e;var d=r.createTabContainer(tuml.tab.Enum.Properties,l,n,{forLookup:!1,forManyComponent:!1,forOneComponent:!0,isOne:!0,forCreation:!0},i);r.setCell(t),r.addToTumlTabViewManagers(d),d.parentTabContainerManager=r;var p=a("#"+r.parentTabContainerManager.getTabId()+"panelPanelDefault"),h=p.find(".tab-content");h.hide(),p.children(".umlg-panel-body.panel-body").height(45);var m=p.find(".umlg-panel-footer.panel-footer");m.hide(),d.backupData=a.extend(!0,{},l.data),void 0!==l.data.refreshFromDb&&l.data.refreshFromDb?(d.createTab(l,!0),d.saveNewRow(),d.tumlTabOneManager.containsOneToOne&&d.parentTabContainerManager.addToOneToOneIndex(l.data.id,{})):(d.createTab(l,-1!==l.data.id.indexOf("fake")),d.tumlTabOneManager.refreshFromDataModel()),0===u&&(s=d),r.passOnValidationResults(d,t.row,r.tumlTabGridManager.grid.getColumns()[t.cell].name)}r.open=!1,null!==s&&r.tabContainer.find("a:first").tab("show");var b=i.qualifiedName;r.updateNavigationHeader(b),r.updateMultiplicityWarningHeader()})},o.prototype.saveTabs=function(){Tuml.TumlTabContainerManager.prototype.saveTabs.call(this),this.tumlTabGridManager.active=!0;var e=a("#"+this.parentTabContainerManager.getTabId()+"panelPanelDefault"),t=e.find(".tab-content");t.show();var n=calculateBodyHeight(this.parentTabContainerManager),i=e.find(".umlg-panel-footer.panel-footer");i.show(),e.children(".umlg-panel-body.panel-body").height(n-10),this.open=!0},o.prototype.closeTab=function(){Slick.GlobalEditorLock.cancelCurrentEdit(),this.tumlTabGridManager.removeGrid(),e.prototype.closeTab.call(this)},l.prototype=new Tuml.TumlTabManyViewManager,l.prototype.closeTab=function(){Slick.GlobalEditorLock.cancelCurrentEdit(),e.prototype.closeTab.call(this)}}(jQuery);