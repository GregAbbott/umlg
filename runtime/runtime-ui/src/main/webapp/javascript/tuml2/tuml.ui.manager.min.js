!function(e){function n(n){function t(e,n,t){if(s.refresh(e,n)){var o=i(n,t);contextManager.refresh(o.name,o.uri,o.contextVertexId)}}function i(e,n){var t=e[0].meta.qualifiedName,i=e[0].meta.to,a=e[0].meta.from,r=void 0==a?null:o(t,a);if(null!=r&&(r.oneToMany||r.manyToMany))return{name:a.name,uri:a.uri,contextVertexId:n};for(var u=0;u<e.length;u++){var s=e[u];if(void 0===s.data&&null===s.data&&alert("UIManager.getContextMetaData response.data !== undefined && response.data !== null"),void 0!==s.data.id&&-1===s.data.id.indexOf("fake")||i.name===tumlModelName)return i=e[u].meta.to,{name:i.name,uri:i.uri,contextVertexId:s.data.id}}return{name:a.name,uri:a.uri,contextVertexId:n}}function o(e,n){if(void 0==n)return null;for(var t=0;t<n.properties.length;t++){var i=n.properties[t];if(i.qualifiedName==e)return i}return alert("Property navigatingTo not found!!!"),null}function a(e){history.pushState({},"firefox ignores this",addUiToUrl(e))}var r,u=this;contextManager=null,this.leftMenuManager=null;var s,c;this.init=function(){var t=parseInt(e(".navbar").css("min-height").replace("px","")),i=5,o=e("body").layout({enableCursorHotkey:!1,livePaneResizing:!0,north:{initClosed:!1,togglerLength_open:0,minSize:t,resizable:!1,spacing_open:i,spacing_closed:i},east:{initClosed:!0,spacing_open:i,spacing_closed:i},south:{minSize:30,togglerLength_open:0,initClosed:!1,resizable:!1,spacing_open:0,spacing_closed:0},west:{minSize:300,spacing_open:i,spacing_closed:i}});o.allowOverflow("north"),o.resizeAll(),contextManager=new Tuml.ContextManager,contextManager.onClickContextMenu.subscribe(function(e,n){u.refresh(n.uri)}),r=new Tuml.MenuManager,this.leftMenuManager=new Tuml.LeftMenuManager,this.leftMenuManager.onMenuClick.subscribe(function(e,n){u.refresh(n.uri)}),this.leftMenuManager.onQueryClick.subscribe(function(e,n){s.addQueryTab(!1,new Tuml.Query(n.id,n.name,n.name,n.queryString,n.queryEnum,null,n.queryType))}),this.leftMenuManager.onDiagramClick.subscribe(function(e,n){s.addDiagramTab(n)}),c=Tuml.FocusEnum.LEFT_MENU,s=new Tuml.TumlMainViewManager(this,this.leftMenuManager),window.onpopstate=function(e){if(null!==e.state&&""===document.location.hash){var n=removeUiFromUrl(document.location.pathname);u.refresh(n,!1)}},e(document).keydown(function(e){if(17!=e.which&&117!=e.which&&27!=e.which&&8!=e.which&&83!=e.which&&39!=e.which)return!0;if(e.ctrlKey&&83==e.which)return u.saveViaKeyPress(),e.preventDefault(),e.stopImmediatePropagation(),!1;if(27==e.which)return u.cancelViaKeyPress(),e.preventDefault(),e.stopImmediatePropagation(),!1;if(e.ctrlKey&&8==e.which)u.goBackOne(),e.preventDefault(),e.stopImmediatePropagation();else if(117==e.which)u.moveFocus(),e.preventDefault(),e.stopImmediatePropagation();else if(39!=e.which)return!0}),e(document).keydown(function(e){return 8!=e.which?!0:e.ctrlKey&&8==e.which?void alert("go back"):!0});var a=new WebSocket("ws://"+window.location.host+"/"+tumlModelName+"/websocket"),l=e("#userCountId");a.onmessage=function(e){console.log(e.data),l.text(tumlModelName+" users = "+e.data)},a.onclose=function(e){console.log(e.data)},a.onerror=function(e){console.log(e.data)},a.onopen=function(e){console.log(e.data)},u.refresh(n)},this.goBackOne=function(){contextManager.goBackOne()},this.moveFocus=function(){c==Tuml.FocusEnum.LEFT_MENU?(c=Tuml.FocusEnum.CENTER_GRID,s.setFocus(c)):c==Tuml.FocusEnum.CENTER_GRID?(c=Tuml.FocusEnum.TOP_CONTEXT,contextManager.setFocus()):c==Tuml.FocusEnum.TOP_CONTEXT?(c=Tuml.FocusEnum.LEFT_MENU,s.setFocus(c)):(c=Tuml.FocusEnum.LEFT_MENU,s.setFocus(c))},this.saveViaKeyPress=function(){s.saveViaKeyPress()},this.cancelViaKeyPress=function(){s.cancelViaKeyPress()},this.refresh=function(n,i){var o=n;-1!==n.indexOf(tumlModelName,n.length-tumlModelName.length)&&(o+="/umlgRoot"),(void 0===i||i)&&a(o);var r=retrieveVertexId(o);null!==r&&(r=decodeURIComponent(r)),e.ajax({url:o,type:"GET",dataType:"json",contentType:"json",success:function(e){retrieveMetaDataIfNotInCache(o,r,e,t)},error:function(e,n,t){alert("error getting "+o+"\n textStatus: "+n+"\n errorThrown: "+t)}})},e.extend(this,{TumlUiManagerVersion:"1.0.0"}),this.init()}function t(){var e=!1,n=!1;this.stopPropagation=function(){e=!0},this.isPropagationStopped=function(){return e},this.stopImmediatePropagation=function(){n=!0},this.isImmediatePropagationStopped=function(){return n}}function i(){var e=[];this.getHandlers=function(){return e},this.subscribe=function(n){e.push(n)},this.unsubscribe=function(n){for(var t=e.length-1;t>=0;t--)e[t]===n&&e.splice(t,1)},this.notify=function(n,i,o){i=i||new t,o=o||this;for(var a,r=0;r<e.length&&!i.isPropagationStopped()&&!i.isImmediatePropagationStopped();r++)a=e[r].call(o,i,n);return a}}function o(){var e=[];this.subscribe=function(n,t){return e.push({event:n,handler:t}),n.subscribe(t),this},this.unsubscribe=function(n,t){for(var i=e.length;i--;)if(e[i].event===n&&e[i].handler===t)return e.splice(i,1),void n.unsubscribe(t);return this},this.unsubscribeAll=function(){for(var n=e.length;n--;)e[n].event.unsubscribe(e[n].handler);return e=[],this}}e.extend(!0,window,{Tuml:{UiManager:n,Event:i,EventData:t,EventHandler:o,FocusEnum:{LEFT_MENU:0,TOP_CONTEXT:1,CENTER_TAB:2,CENTER_GRID:3}}}),e.extend(this,{TumlUIVersion:"1.0.0",refreshUri:new Tuml.Event})}(jQuery);