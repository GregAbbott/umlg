<html>
<head>	
	<link type="text/css" rel="stylesheet" href="layout/layout-default-latest.css" />
	<link rel="stylesheet" href="slick.grid.css" type="text/css"/>
	<link rel="stylesheet" href="css/smoothness/jquery-ui-1.8.16.custom.css" type="text/css"/>
	<script src="lib/jquery-1.7.min.js"></script>
	<script src="lib/jquery-ui-1.8.16.custom.min.js"></script>
	<script src="lib/jquery.event.drag-2.0.min.js"></script>
	<script src="layout/jquery.layout-latest.js"></script>
	<script src="slick.core.js"></script>
	<script src="slick.grid.js"></script>
	<script>

	var myLayout;
	$(document).ready(function() {
		// $('body').layout({ applyDefaultStyles: true, resizable: true });
		// init instance var
		var myLayout = $('body').layout({

			//	reference only - these options are NOT required because 'true' is the default
			closable: true // pane can open & close
			,
			resizable: true // when open, pane can be resized 
			,
			slidable: true // when closed, pane can 'slide' open over other panes - closes on mouse-out
			,
			livePaneResizing: true

			//	some resizing/toggling settings
			,
			north__slidable: false // OVERRIDE the pane-default of 'slidable=true'
			,
			north__togglerLength_closed: '100%' // toggle-button is full-width of resizer-bar
			,
			north__spacing_closed: 20 // big resizer-bar when open (zero height)
			,
			south__resizable: false // OVERRIDE the pane-default of 'resizable=true'
			,
			south__spacing_open: 0 // no resizer-bar when open (zero height)
			,
			south__spacing_closed: 20 // big resizer-bar when open (zero height)
			//	some pane-size settings
			,
			west__minSize: 100,
			east__size: 300,
			east__minSize: 200,
			east__maxSize: .5 // 50% of layout width
			,
			center__minWidth: 100

			//	some pane animation settings
			,
			west__animatePaneSizing: false,
			west__fxSpeed_size: "fast" // 'fast' animation when resizing west-pane
			,
			west__fxSpeed_open: 1000 // 1-second animation when opening west-pane
			,
			west__fxSettings_open: {
				easing: "easeOutBounce"
			} // 'bounce' effect when opening
			,
			west__fxName_close: "none" // NO animation when closing west-pane
			//	enable showOverflow on west-pane so CSS popups will overlap north pane
			,
			west__showOverflowOnHover: true

			//	enable state management
			,
			stateManagement__enabled: true // automatic cookie load & save enabled by default
			,
			showDebugMessages: true // log and/or display messages from debugging & testing code
		});

		// layout utilities
		// myLayout.addPinBtn("#myPinButton", "west");
		myLayout.allowOverflow("north");

		var meta = {};
		meta.tumlUri = "/restAndJson";
		refreshPageTo(meta);

	});


	var stateObj = { foo: "bar" };
	function change_my_url(url)
	{
		history.pushState(stateObj, "page 2", "/view" + url);
	}


	function refreshPageTo(meta) {
		change_my_url( meta.tumlUri )

		// var jqxhr = $.getJSON("http://localhost:8111/restAndJson/aliens", function(a, b, c) {
		var jqxhr = $.getJSON(meta.tumlUri, function(a, b, c) {
			var menuArray = [];
			$.each(a.meta.properties, function(index, metaProperty) {
				menuArray[index] = metaProperty;
			});
			createLeftMenu(menuArray);
		}).fail(function(a, b, c) {
			alert("error " + a + ' ' + b + ' ' + c);
		});

		var jqxhr = $.getJSON(meta.tumlUri, function(a, b, c) {
			var meta = [];
			if (a.data instanceof Array) {
				$.each(a.data, function(index, rowArray) {
					var gridObject = {};
					for(var i=0, len=rowArray.length; i < len; i++) {
						var rowPropertyObject = rowArray[i]; 
						gridObject[rowPropertyObject.name] = rowPropertyObject.value;
					}
					meta[index] = gridObject;
					// console.log(data);
				});
				createGrid(meta);
			} else {
				createPageForObject(a.meta);
			}
		}).fail(function(a, b, c) {
			alert("error " + a + ' ' + b + ' ' + c);
		});
		
	}


	function createPageForObject(data) {
		alert("create data for one page " + data);
	}

	function createGrid(data, columns) {
		var grid;
		var columns = [{
			id: "id",
			name: "id",
			field: "id"
		}, {
			id: "name",
			name: "name",
			field: "name"
		}];
		var options = {
			enableCellNavigation: true,
			enableColumnReorder: false
		};
		grid = new Slick.Grid(".ui-layout-center", data, columns, options);
	}

	function createLeftMenu(meta) {
		$('.ui-left-menu-link').children().remove();
		$.each(meta, function(index, value) {
			$('.ui-left-menu-link').append('<li>').append(
				$('<a>',{
						text: meta[index].name,
						title: meta[index].name,
						href: meta[index].tumlUri,
						click: function(){ refreshPageTo( meta[index] );return false;}
					}
				)).append('</li>');
		});
	}



</script>
</head>
<body>
	<div class="ui-layout-center">Center
		<div class="ui-grid"></div>
	</div>
	<div class="ui-layout-north">North</div>
	<div class="ui-layout-south">South</div>
	<div class="ui-layout-east">East</div>
	<div class="ui-layout-west">
		<ul class="ui-left-menu-link">
		</ul>
	</div>
</body>
</html>