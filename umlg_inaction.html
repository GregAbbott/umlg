<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>UMLG</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- UMLG doc style -->
    <link href="stylesheets/umlg-doc.css" rel="stylesheet">

    <!-- Syntax Highlighter -->
    <link href="stylesheets/prettify.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body data-spy="scroll" data-target="#affix-nav">
<header class="navbar navbar-fixed-top navbar-inverse" role="banner">
    <div class="container">
        <div class="navbar-header">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="index.html" class="navbar-brand">UMLG</a>
        </div>
        <nav class="collapse navbar-collapse" role="navigation">
            <ul class="nav navbar-nav pull-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="doc_home.html">Home</a></li>
                        <li><a href="introduction.html">Introduction</a></li>
                        <li><a href="getting_started.html">Getting Started</a></li>
                        <li><a href="umlg_inaction.html">UMLG In action</a></li>
                        <li><a href="gremlin_extension.html">Gremlin Extension</a></li>
                        <li><a href="umlg_reference.html">UMLG Reference</a></li>
                        <li><a href="ocl_reference.html">OCL reference</a></li>
                        <li><a href="rest_interface.html">Rest Interface</a></li>
                        <li><a href="gui.html">Gui</a></li>
                    </ul>
                </li>
                <li>
                    <a href="https://github.com/pietermartin/umlg">Github</a>
                </li>
                <li>
                    <a href="http://demo.umlg.org">Demo</a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<div class="jumbotron umlg-doc-jumbotron">
    <p>UMLG In Action</p>
</div>

<!-- Begin Body -->
<div class="container umlgcontainer">
    <div class="row">
        <div class="col-md-3" id="leftcol">
            <div class="bs-docs-sidebar hidden-print" role="complementary">
                <ul class="nav bs-docs-sidebar" id="sidebar">
                    <li class="active"><a href="#UmlgGraphinterfaceID">UmlgGraph interface</a></li><li><a href="#AccessyourentitiesID">Access your entities</a><ul class="nav">
<li><a href="#AccessingRootEntitiesID">Accessing Root Entities</a><ul class="nav">
<li><a href="#AccessrootentitiesexampleID">Access root entities example</a></li></ul>
</li><li><a href="#Accessingallinstancesofanyentity.ID">Accessing all instances of any entity.</a><ul class="nav">
<li><a href="#AccessentitiesbyallInstancesID">Access entities by allInstances</a></li></ul>
</li><li><a href="#Accessingallconcreteinstancesofaninterfacebyclass.ID">Accessing all concrete instances of an interface by class.</a></li></ul>
</li><li><a href="#IndexingID">Indexing</a></li><li><a href="#QueriesID">Queries</a><ul class="nav">
<li><a href="#OCLID">OCL</a></li><li><a href="#Gremlin/GroovyID">Gremlin/Groovy</a></li><li><a href="#CypherID">Cypher</a></li></ul>
</li>
                </ul>
            </div>
        </div>
        <div class="col-md-9">

            <p class="pull-right visible-xs">
                <button type="button" class="btn btn-primary btn-xs" data-toggle="offcanvas">Toggle nav</button>
            </p>
            <!-- UMLG In Action -->

<p>This section explains UMLG's primary interface <code class="language-java">org.umlg.runtime.adaptor.UmlgGraph</code>.</ br></p>

<h2 id="UmlgGraphinterfaceID">UmlgGraph interface</h2>

<p><code class="language-java">UmlgGraph</code> extends both <code class="language-java">com.tinkerpop.blueprints.TransactionalGraph</code> and <code class="language-java">com.tinkerpop.blueprints.KeyIndexableGraph</code>.
<code class="language-java">UmlgGraph</code> follows the singleton pattern and is always available on the current thread. To access it call the static 
method <code class="language-java">org.umlg.runtime.adaptor.UMLG.get()</code>.</p>

<p>Some important methods on <code class="language-java">UmlgGraph</code> are,</p>

<pre class="prettyprint"><code class="language-java">&lt;T extends PersistentObject&gt; T getEntity(Object id);

&lt;T extends PersistentObject&gt; T getFromUniqueIndex(String key, Object value);

&lt;T extends PersistentObject&gt; List&lt;T&gt; getFromIndex(String key, Object value);

String executeQueryToString(UmlgQueryEnum umlgQueryEnum, Object contextId, String query);

Object executeQuery(UmlgQueryEnum umlgQueryEnum, Object contextId, String query);
</code></pre>

<p><code class="language-java">getEntity</code> retrieves an entity from the db given its vertex id.</p>

<p><code class="language-java">getFromUniqueIndex</code> retrieves an entity that has been uniquely indexed for a key and value of one of is properties.
The key is the qualified name of the property.</p>

<p><code class="language-java">getFromIndex</code> is the same as <code class="language-java">getFromUniqueIndex</code> except that the index is not unique and thus returns a List</p>

<p><code class="language-java">executeQueryToString</code> executes a query and returns the result as a <code class="language-java">String</code>. UmlgQueryEnum can be OCL, GROOVY or NATIVE,
UmlgQueryEnum.GROOVY includes Gremlin queries.</p>

<p><code class="language-java">executeQuery</code> executes a query returning the raw result. In the case of OCL the raw result will be your entities.</p>

<h2 id="AccessyourentitiesID">Access your entities</h2>

<p>There are many ways to get access to your entities.</p>

<h3 id="AccessingRootEntitiesID">Accessing Root Entities</h3>

<p>UMLG generates a class that represents the model. It is a singleton and gives you access to the root objects of the model.
Root objects are classes that have no composite parent. A composite parent is a class at the other end of a composite 
association.</p>

<p><img src="images/uml/umlggraph/compositeAssociation.png" alt="image of model" title="" /></p>

<p>Window is a root object as it does not have a composite parent. As such it is accessible from the model class <code class="language-java">Quickpreview</code>.</p>

<p>Slider, Header and Panel have Window as its composite parent.</p>

<p><br /></p>

<h4 id="AccessrootentitiesexampleID">Access root entities example</h4>

<pre class="prettyprint"><code class="language-java">@Test
public void testRootEntities() {
    Window window1 = new Window();
    Slider slider1_1 = new Slider(window1);
    Slider slider1_2 = new Slider(window1);
    Header header1 = new Header(window1);
    Panel panel1 = new Panel(window1);

    Window window2 = new Window();
    Slider slider2_1 = new Slider(window2);
    Slider slider2_2 = new Slider(window2);
    Header header2 = new Header(window2);
    Panel panel2 = new Panel(window2);

    db.commit();

    //All root object are accessible from the class that represents the model.
    Assert.assertEquals(2, Quickpreview.INSTANCE.getWindow().size());
}
</code></pre>

<h3 id="Accessingallinstancesofanyentity.ID">Accessing all instances of any entity.</h3>

<p>All concrete instances of an abstract or concrete entity can be accessed via the static <code class="language-java">allInstances</code> method on the class.</p>

<p><img src="images/uml/umlggraph/allInstances.png" alt="image of model" title="" /></p>

<p><br /></p>

<h4 id="AccessentitiesbyallInstancesID">Access entities by allInstances</h4>

<pre class="prettyprint"><code class="language-java">@Test
public void testAllInstances() {
    Drawing drawing1 = new Drawing();
    Polygon polygon1 = new Polygon();
    polygon1.setDrawing(drawing1);
    Polygon polygon2 = new Polygon();
    polygon2.setDrawing(drawing1);
    Eclipse eclipse1 = new Eclipse();
    eclipse1.setDrawing(drawing1);
    Spline spline1 = new Spline();
    spline1.setDrawing(drawing1);
    Spline spline2 = new Spline();
    spline2.setDrawing(drawing1);
    Spline spline3 = new Spline();
    spline3.setDrawing(drawing1);

    db.commit();

    Assert.assertEquals(1, Drawing.allInstances().size());
    Assert.assertEquals(6, Shape.allInstances().size());
    Assert.assertEquals(2, Polygon.allInstances().size());
    Assert.assertEquals(1, Eclipse.allInstances().size());
    Assert.assertEquals(3, Spline.allInstances().size());
}
</code></pre>

<h3 id="Accessingallconcreteinstancesofaninterfacebyclass.ID">Accessing all concrete instances of an interface by class.</h3>

<p>All concrete instances of an interface can be accessed via the static <code class="language-java">getAllInstances</code> method on the class's metaclass.</p>

<p>Every interface and class in the UML model has a corresponding meta class generated. The meta class's name is class's 
name with 'meta appended' to it. The meta class is a singleton and access by its corresponding static <code class="language-java">getInstance</code> method.</p>

<p><img src="images/uml/umlggraph/interfaceAllInstances.png" alt="image of model" title="" /></p>

<pre class="prettyprint"><code class="language-java">@Test
public void testInterfaceAllInstances() {
    Creator creator = new Creator();
    Ghost ghost1 = new Ghost();
    ghost1.setCreator(creator);
    Ghost ghost2 = new Ghost();
    ghost2.setCreator(creator);
    Mamal mamal1 = new Mamal();
    mamal1.setCreator(creator);
    Mamal mamal2 = new Mamal();
    mamal2.setCreator(creator);
    Mamal mamal3 = new Mamal();
    mamal3.setCreator(creator);

    db.commit();
    Assert.assertEquals(5, SpiritMeta.getInstance().getAllInstances().size());
    Assert.assertEquals(3, BeingMeta.getInstance().getAllInstances().size());
}
</code></pre>

<h2 id="IndexingID">Indexing</h2>

<p>Umlg makes extensive use of blueprint's indexing mechanism to implement UML qualifiers. Qualifier's make use of 
blueprints indexing mechanism but the indexed value is always in the context of an owning class. Have a look at the 
<a href="/umlg-gh-pages/gh-pages/umlg_reference.html#QualifiersID">UMLG Reference</a> page for details.</p>

<p>UMLG also supports global indexing. Global indexing is the standard blueprints indexing mechanism where any vertex or 
edge property is indexed and can be retrieved via the index. This is a concept that is not present in UML.</p>

<p>To do this UMLG uses a stereotype to mark any datatype (a primitive or one of UMLG's build in data types) property to be 
indexed. The index stereotype has one property to specify whether the index is a unique index or not. A unique index
will enforce that the value of the property is unique across the whole graph. A non-unique index may contain duplicates.</p>

<p><img src="images/uml/index/uniqueOrNotIndex.png" alt="image of model" title="" /></p>

<p>For every stereotype indexed property UMLG generates a corresponding static finder method in the owning class. 
The finder method's name is <code class="language-java">finderByXXX</code> where XXX is the name of the property.</p>

<p>The example below illustrates the finder methods on Program.</p>

<pre class="prettyprint"><code class="language-java">@Test(expected = IllegalStateException.class)
public void testUniqueIndexing() {
    Program program1 = new Program();
    program1.setName("Program1");
    db.commit();

    //This will fail as name has a unique index specified on it.
    Program program2 = new Program();
    program2.setName("Program1");
    db.commit();
}

@Test
public void testIndexing() {
    for (int i = 0; i &lt; 1000; i++) {
        Program program1 = new Program();
        program1.setName("Program" + i);
    }
    db.commit();

    Assert.assertNotNull(Program.findByName("Program1"));
    Assert.assertNotNull(Program.findByName("Program500"));
    Assert.assertNotNull(Program.findByName("Program999"));
}

@Test
public void testNonUniqueIndexing() {
    LocalDate now = LocalDate.now();
    Program program1 = new Program();
    program1.setStart(now);
    Program program2 = new Program();
    program2.setStart(now);
    Program program3 = new Program();
    program3.setStart(now);

    LocalDate tomorrow = now.plusDays(1);
    Program program4 = new Program();
    program4.setStart(tomorrow);
    Program program5 = new Program();
    program5.setStart(tomorrow);
    db.commit();

    Assert.assertEquals(3, Program.findByStart(now).size());
    Assert.assertEquals(2, Program.findByStart(tomorrow).size());
}

@Test
public void testNonUniqueEnumIndex() {
    Program program1 = new Program();
    program1.setProgramType(ProgramType.NEWS);
    Program program2 = new Program();
    program2.setProgramType(ProgramType.NEWS);
    Program program3 = new Program();
    program3.setProgramType(ProgramType.NEWS);

    Program program4 = new Program();
    program4.setProgramType(ProgramType.SPORT);
    Program program5 = new Program();
    program5.setProgramType(ProgramType.SPORT);

    db.commit();
    Assert.assertEquals(3, Program.findByProgramType(ProgramType.NEWS).size());
    Assert.assertEquals(2, Program.findByProgramType(ProgramType.SPORT).size());
}
</code></pre>

<h2 id="QueriesID">Queries</h2>

<p>Queries can be executed in OCL, Gremlin/Groovy and in the case of Neo4j, Cypher.</p>

<p>All queries are executed via UMLG's primary graph interface. <code class="language-java">UMLG.get().executeQuery(UmlgQueryEnum umlgQueryEnum, Object contextId, String query)</code></p>

<p><code class="language-java">UmlgQueryEnum</code> is one of <code class="language-java">OCL, GROOVY, NATIVE</code></p>

<p>The <code class="language-java">contextId</code> can be either a UMLG entity, a vertex id or the fully qualified name of a entity.</p>

<h3 id="OCLID">OCL</h3>

<p>UMLG supports UML's OCL language. It can be used at design time in the model to specify constraints, default values, 
derived properties and query operations.</p>

<p>It can also be used runtime to query the graph in an object-oriented manner. Any ocl expression can be evaluated against 
the system at runtime.</p>

<p><img src="images/uml/query/query.png" alt="image of model" title="" /></p>

<pre class="prettyprint"><code class="language-java">@Test
public void testOcl() {
    Customer customer = new Customer();
    customer.setName("john");

    Purchase car1 = new Purchase();
    car1.setName("bmw");
    customer.addToPurchase(car1);

    Purchase car2 = new Purchase();
    car2.setName("merc");
    customer.addToPurchase(car2);

    Account account1 = new Account();
    account1.setBalance(1000D);
    customer.addToAccount(account1);

    Account account2 = new Account();
    account2.setBalance(10D);
    customer.addToAccount(account2);

    db.commit();

    //derived property largeAccounts is generated as a getter on the entity
    Assert.assertEquals(1, customer.getLargeAccounts().size());

    Set&lt;Purchase&gt; cars = db.executeQuery(
            UmlgQueryEnum.OCL,
            customer,
            "self.purchase"
    );
    Assert.assertEquals(2, cars.size());

    Set&lt;Account&gt; large = db.executeQuery(
            UmlgQueryEnum.OCL,
            customer,
            "self.account-&gt;select(balance &gt; 100)"
    );
    Assert.assertEquals(1, large.size());
    Assert.assertEquals(1000D, large.iterator().next().getBalance(), 0);

    Set&lt;Account&gt; small = db.executeQuery(
            UmlgQueryEnum.OCL,
            customer,
            "self.account-&gt;select(balance &lt; 100)"
    );
    Assert.assertEquals(1, small.size());
    Assert.assertEquals(10D, small.iterator().next().getBalance(), 0);
}
</code></pre>

<p>Please see the <a href="/umlg-gh-pages/gh-pages/ocl_reference.html">OCL Reference</a> guide for further details.</p>

<h3 id="Gremlin/GroovyID">Gremlin/Groovy</h3>

<p>UMLG supports the execution of groovy and gremlin scripts.</p>

<pre class="prettyprint"><code class="language-java">@Test
public void testGremlin() {
    Customer customer = new Customer();
    customer.setName("john");

    Purchase car1 = new Purchase();
    car1.setName("bmw");
    customer.addToPurchase(car1);

    Purchase car2 = new Purchase();
    car2.setName("merc");
    customer.addToPurchase(car2);

    Account account1 = new Account();
    account1.setBalance(1000D);
    customer.addToAccount(account1);

    Account account2 = new Account();
    account2.setBalance(10D);
    customer.addToAccount(account2);

    db.commit();

    //'self' translates to g.V(id) where id is the customers id
    Assert.assertEquals("john", db.executeQuery(UmlgQueryEnum.GROOVY, customer, "self.name"));

    Object result = db.executeQuery(UmlgQueryEnum.GROOVY, customer, "self.both.has('name').name");
    Assert.assertTrue(result instanceof Pipeline);
    List&lt;String&gt; names = new ArrayList();
    for (String name : (Pipeline&lt;Object, String&gt;)result) {
        names.add(name);
    }
    Assert.assertEquals(2, names.size());
    Assert.assertTrue(names.contains("merc"));
    Assert.assertTrue(names.contains("merc"));
}
</code></pre>

<h3 id="CypherID">Cypher</h3>


        </div>
    </div>
    <hr>
    <footer class="pull-right">
        <p>100% open source. Licensed under the Apache Software License 2.0</p>
    </footer>

</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<script src="javascripts/offcanvas.js"></script>
<script src="javascripts/prettify.js"></script>

<script type='text/javascript'>

    $(document).ready(function () {

        $('#sidebar').affix(
                {
                    offset: {
                        top: 80
                    }
                }
        );

        var $body = $(document.body);
        var navHeight = $('.navbar').outerHeight(true) + 10;

        $body.scrollspy({
            target: '#leftcol',
            offset: navHeight
        });

        /* smooth scrolling sections */
        $('a[href*=#]:not([href=#])').click(function () {
            if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
                var target = $(this.hash);
                target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                if (target.length) {
                    $('html,body').animate({
                        scrollTop: target.offset().top - 50
                    }, 1000);
                    return false;
                }
            }
        });

    });

    prettyPrint();

</script>

</body>
</html>
